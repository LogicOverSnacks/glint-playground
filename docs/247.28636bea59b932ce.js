"use strict";(self.webpackChunkgit_glint=self.webpackChunkgit_glint||[]).push([[247],{3247:(Rt,X,i)=>{i.r(X),i.d(X,{BlameLayoutModule:()=>wt});var j=i(2798),Y=i(1117),U=i(9183),Z=i(9563),t=i(4438);let H=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[U.D6,Y.U,Z.Z]})}}return s})();var F=i(2724),q=i(1635),C=i(9969),S=i(9417),N=i(9843),G=i(5585),M=i(4412),d=i(7673),v=i(8810),E=i(4572),V=i(7468),f=i(6354),y=i(9437),p=i(6977),$=i(3294),D=i(8141),L=i(5558),u=i(4548),J=i(3130),Q=i(949),B=i(319),w=i(2039),I=i(877),tt=i(986),et=i(2140),nt=i(4748),ot=i(3350),z=i(2102),it=i(6600),b=i(177),st=i(8834),W=i(9213),_=i(4823),k=i(477),at=i(1441),lt=i(313),R=i(5272),ct=i(3103),mt=i(6697),rt=i(8694),dt=i(5345),ht=i(3042),gt=i(4766),pt=i(5969),ut=i(7575),Ct=i(6166),A=i(5458),K=i(1751),ft=i(9767);const Mt=["scrollContainer"];function Pt(s,h){1&s&&(t.j41(0,"div",7),t.nrm(1,"mat-spinner"),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Loading..."),"\n"))}function Ot(s,h){if(1&s&&(t.j41(0,"span",13)(1,"span",14),t.EFF(2),t.k0s(),t.nrm(3,"app-avatar",15),t.nI1(4,"async"),t.j41(5,"span",16),t.EFF(6),t.k0s(),t.j41(7,"span",17),t.EFF(8),t.nI1(9,"translateDate"),t.k0s()()),2&s){const e=h.ngIf,n=t.XpG(2),o=t.sdS(11);t.xc7("left",-n.lineNumberMargin-26-400,"px"),t.Y8G("appContextMenu",o)("appContextMenuData",e),t.R7$(),t.Y8G("matTooltip",e.commitId),t.R7$(),t.JRh(e.commitId),t.R7$(),t.Y8G("matTooltip",e.name+" ("+e.email+")")("remotes",t.bMT(4,12,n.remotes))("email",e.email),t.R7$(2),t.Y8G("matTooltip",e.message),t.R7$(),t.JRh(e.message),t.R7$(2),t.JRh(t.i5U(9,14,e.date,"mediumDate"))}}function vt(s,h){if(1&s&&(t.j41(0,"span",19),t.EFF(1),t.k0s()),2&s){const e=h.$implicit;t.Y8G("ngClass",e.class),t.R7$(),t.JRh(e.text)}}function bt(s,h){if(1&s&&(t.qex(0),t.DNE(1,vt,2,2,"span",18),t.nI1(2,"findToken"),t.nI1(3,"tokens"),t.bVm()),2&s){const e=h.ngIf,n=t.XpG().index;t.R7$(),t.Y8G("ngForOf",t.i5U(3,5,t.brH(2,1,e.tokens,e.text,n),e.text))}}function xt(s,h){if(1&s&&(t.j41(0,"li",8),t.DNE(1,Ot,10,17,"span",9),t.nI1(2,"async"),t.j41(3,"span",10),t.EFF(4),t.k0s(),t.j41(5,"span",11),t.EFF(6),t.k0s(),t.DNE(7,bt,4,8,"ng-container",12),t.k0s()),2&s){let e;const n=h.$implicit,o=t.XpG();t.Y8G("ngClass","line-"+n.status),t.R7$(),t.Y8G("ngIf",null==(e=t.bMT(2,11,o.blameLines$))?null:e[null==n.newLine?null:n.newLine.lineNumber]),t.R7$(2),t.xc7("right","calc(100% + 26px + "+(o.lineNumberMargin/2).toString()+"px)")("width",o.lineNumberMargin/2-5,"px"),t.R7$(),t.JRh(null==n.oldLine?null:n.oldLine.lineNumber),t.R7$(),t.xc7("width",o.lineNumberMargin/2-5,"px"),t.R7$(),t.JRh(null==n.newLine?null:n.newLine.lineNumber),t.R7$(),t.Y8G("ngIf",o.getLineView(n))}}function Ft(s,h){if(1&s){const e=t.RV6();t.j41(0,"div",20)(1,"button",21),t.bIt("click",function(){const o=t.eBV(e).data,a=t.XpG();return t.Njj(a.copyToClipboard(o.commitId))}),t.j41(2,"mat-icon"),t.EFF(3,"content_copy"),t.k0s(),t.j41(4,"span"),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"button",21),t.bIt("click",function(){const o=t.eBV(e).data,a=t.XpG();return t.Njj(a.selectCommit(o.commitId))}),t.j41(8,"mat-icon"),t.EFF(9,"document_scanner"),t.k0s(),t.j41(10,"span"),t.EFF(11),t.nI1(12,"translate"),t.k0s()(),t.j41(13,"button",21),t.bIt("click",function(){const o=t.eBV(e).data,a=t.XpG();return t.Njj(a.jumpToCommit(o.commitId))}),t.j41(14,"mat-icon"),t.EFF(15,"launch"),t.k0s(),t.j41(16,"span"),t.EFF(17),t.nI1(18,"translate"),t.k0s()()()}if(2&s){const e=h.data;t.R7$(),t.Y8G("matTooltip",e.commitId),t.R7$(4),t.JRh(t.bMT(6,6,"Copy Commit ID")),t.R7$(2),t.Y8G("matTooltip",e.commitId),t.R7$(4),t.JRh(t.bMT(12,8,"Blame from this Commit")),t.R7$(2),t.Y8G("matTooltip",e.commitId),t.R7$(4),t.JRh(t.bMT(18,10,"Jump to Commit"))}}let yt=(()=>{class s extends((0,J.c)(Q.N,rt.f)){constructor(e,n,o,a,l){super(),this.router=e,this.store=n,this.diffService=o,this.diffSelectionService=a,this.findSelectionService=l,this.commitChanged=new t.bkB,this.lineNumberMargin=0,this.lines$=new M.t([]),this.blameLines$=new M.t({})}ngOnInit(){const e=this.scrollContainer.nativeElement;this.remotes=this.repository.pipe((0,f.T)(n=>n?.remotes??[])),this.blame.pipe((0,p.Q)(this.destroyed$)).subscribe(n=>{if(n){const o=n.hunks.map(a=>[a.startLineNo,{name:a.authorName,email:a.authorEmail,commitId:a.commitId,message:a.commitMessage,date:a.commitDate}]);this.blameLines$.next(Object.fromEntries(o))}else this.blameLines$.next({})}),this.diffLines.pipe((0,ct.c)(0),(0,p.Q)(this.destroyed$)).subscribe(n=>{if(n){const o=Math.max(n.oldLines.length,n.newLines.length)??0;this.lineNumberMargin=this.diffService.calculateMargin(o.toString().length),this.diffService.calculateInlineLines(n.oldLines,n.newLines,n.hunks).pipe((0,p.Q)(this.destroyed$)).subscribe(a=>{this.lines$.next(a)})}else this.lineNumberMargin=0,this.lines$.next([])}),(0,E.z)([this.lines$,this.findSelectionService.searchRegex]).pipe((0,p.Q)(this.destroyed$)).subscribe(([n,o])=>{if(!o)return void this.findSelectionService.setMatches([]);const a=n.map((l,g)=>[this.getLineView(l),g]).flatMap(([l,g])=>l?Array.from(l.text.matchAll(o),m=>({lineId:g,startIndex:m.index??0,endIndex:(m.index??0)+(m[0]?.length??0)})):[]);this.findSelectionService.setMatches(a)}),this.findSelectionService.selectedMatch.pipe((0,p.Q)(this.destroyed$)).subscribe(n=>{if(!n||"number"!=typeof n.lineId)return;const o=this.lineNumberMargin+26+400+10+n.startIndex*this.diffSelectionService.charWidth;e.scrollTo(o<e.scrollLeft?o:o>e.scrollLeft+e.clientWidth?this.lineNumberMargin+26+400+10+n.endIndex*this.diffSelectionService.charWidth-e.clientWidth:e.scrollLeft,19*n.lineId)})}getLineView(e){return"added"===e.status?e.newLine:"removed"===e.status?e.oldLine:"unchanged"===e.status?e.newLine??e.oldLine:null}trackByDiffLine(e,n){return e}copyToClipboard(e){navigator.clipboard.writeText(e??"")}selectCommit(e){this.commitChanged.next(e)}jumpToCommit(e){this.repository.pipe((0,mt.s)(1),(0,p.Q)(this.destroyed$)).subscribe(n=>{if(!n)throw new u.Y7;this.store.dispatch([new w.$P(n.path,e),new w.Ks(n.path,e)]).subscribe(()=>{this.router.navigate(["/standard/default"])})})}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(F.Ix),t.rXU(N.il),t.rXU(dt.T),t.rXU(ht.h),t.rXU(gt.v))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-blame-view"]],viewQuery:function(n,o){if(1&n&&(t.GBs(Mt,7,t.aKT),t.GBs(R.d6,5)),2&n){let a;t.mGM(a=t.lsd())&&(o.scrollContainer=a.first),t.mGM(a=t.lsd())&&(o.viewports=a)}},inputs:{repository:"repository",blame:"blame",diffLines:"diffLines"},outputs:{commitChanged:"commitChanged"},features:[t.Vt3],decls:12,vars:14,consts:[["scrollContainer",""],["code",""],["contextMenu",""],["class","loading",4,"ngIf"],[1,"viewport",3,"itemSize","maxBufferPx","minBufferPx"],["tabindex","0",1,"vs-code-theme"],["class","line",3,"ngClass",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[1,"loading"],[1,"line",3,"ngClass"],["class","blame",3,"left","appContextMenu","appContextMenuData",4,"ngIf"],[1,"old-line-number"],[1,"new-line-number"],[4,"ngIf"],[1,"blame",3,"appContextMenu","appContextMenuData"],[1,"commit-id",3,"matTooltip"],[3,"matTooltip","remotes","email"],[1,"message",3,"matTooltip"],[1,"date"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"menu-panel"],[1,"menu-item",3,"click","matTooltip"]],template:function(n,o){1&n&&(t.DNE(0,Pt,4,3,"div",3),t.nI1(1,"async"),t.nI1(2,"nullEmpty"),t.j41(3,"cdk-virtual-scroll-viewport",4,0)(5,"code",5,1)(7,"ul"),t.DNE(8,xt,8,13,"li",6),t.nI1(9,"async"),t.k0s()()(),t.DNE(10,Ft,19,12,"ng-template",null,2,t.C5r)),2&n&&(t.Y8G("ngIf",!t.bMT(2,10,t.bMT(1,8,o.lines$))),t.R7$(3),t.Y8G("itemSize",19)("maxBufferPx",1e3)("minBufferPx",200),t.R7$(4),t.xc7("margin-left",o.lineNumberMargin+26+400+10,"px"),t.R7$(),t.Y8G("cdkVirtualForOf",t.bMT(9,12,o.lines$))("cdkVirtualForTrackBy",o.trackByDiffLine))},dependencies:[U.LG,R.yg,R.E$,R.d6,b.YU,b.Sq,b.bT,W.An,_.oV,k.f,pt.Q,b.Jj,ut.f,Ct.T,A.J,K.D,ft.R],styles:[".loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;margin:20px;width:100px}code[_ngcontent-%COMP%]{display:block;white-space:pre}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]{position:absolute;width:400px;overflow:hidden;user-select:none;font-size:0;display:flex;justify-content:space-between;align-items:center;gap:5px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{width:16px;height:16px;flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:1rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%]{flex:0 0 50px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{flex:1 1 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{position:absolute;text-align:right;user-select:none}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{right:calc(100% + 26px)}.viewport[_ngcontent-%COMP%]{height:100%;width:100%}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#858585}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#5e5e5e}"],changeDetection:0})}}return s})();function It(s,h){if(1&s&&(t.j41(0,"span"),t.nrm(1,"app-avatar",8),t.nI1(2,"async"),t.j41(3,"span",9),t.EFF(4),t.k0s()()),2&s){const e=h.ngIf,n=t.XpG();t.R7$(),t.Y8G("matTooltip",e.name+" ("+e.email+")")("remotes",t.bMT(2,4,n.remotes))("email",e.email),t.R7$(3),t.JRh(e.message)}}function Tt(s,h){if(1&s&&(t.j41(0,"mat-option",10)(1,"div",11),t.nrm(2,"app-avatar",8),t.nI1(3,"async"),t.j41(4,"span",12),t.EFF(5),t.k0s(),t.j41(6,"span",13),t.EFF(7),t.nI1(8,"translateDate"),t.k0s()()()),2&s){const e=h.$implicit,n=t.XpG();t.Y8G("value",e.id),t.R7$(2),t.Y8G("matTooltip",e.name+" ("+e.email+")")("remotes",t.bMT(3,7,n.remotes))("email",e.email),t.R7$(2),t.Y8G("matTooltip",e.message),t.R7$(),t.JRh(e.message),t.R7$(2),t.JRh(t.i5U(8,9,e.date,"mediumDate"))}}const $t=[{path:"",component:(()=>{class s extends((0,J.c)(Q.N)){constructor(e,n,o,a,l,g,m){super(),this.route=e,this.router=n,this.store=o,this.commitsApi=a,this.highlightApi=l,this.repositoriesApi=g,this.routerHistoryService=m,this.blame=new M.t(null),this.headBlame=new M.t(null),this.commits=new M.t([]),this.diffLines=new M.t(null),this.selectedCommitControl=new S.MJ(null),this.selectedCommit=new M.t(null),this.selectedPath=new M.t(null),this.jumpToSelectedCommit=()=>{const c=this.store.selectSnapshot(I.s.selectedRepositoryPath),r=this.selectedCommitControl.value;if(!c)throw new u.Y7;if(!r)throw new u.jO;this.store.dispatch([new w.$P(c,r),new w.Ks(c,r)]).subscribe(()=>{this.router.navigate(["/standard/default"])})},this.close=()=>{const c=this.routerHistoryService.history.findLast(r=>!r.startsWith("/standard/blame"))??"/standard/default";this.router.navigate([c])},this.getPatch=(c,r,P,T)=>"head"===P?("staged"===T?c.stagedChanges:"unstaged"===T?c.unstagedChanges:void 0)?.find(x=>x.newFilePath===r)?("staged"===T?this.repositoriesApi.getStagedPatch(c.path,void 0,r):this.repositoriesApi.getUnstagedPatch(c.path,void 0,r)).pipe((0,f.T)(x=>({repositoryPath:c.path,patch:x,isUnstaged:"unstaged"===T})),(0,y.W)(x=>u.CS.matches(x)?(0,v.$)(()=>new B.XR(x)):(0,v.$)(()=>x))):(0,d.of)(null):"commit"!==T?(0,d.of)(null):this.commitsApi.getPatch(c.path,P,void 0,r).pipe((0,f.T)(O=>({repositoryPath:c.path,patch:O,isUnstaged:!1})),(0,y.W)(O=>u.z9.matches(O)||u.CS.matches(O)?(0,v.$)(()=>new B.XR(O)):(0,v.$)(()=>O)))}ngOnInit(){this.remotes=this.selectedRepository.pipe((0,f.T)(e=>e?.remotes??[])),this.headBlame.pipe((0,f.T)(e=>{if(!e)return[];const n={};for(const o of e.hunks)n[o.commitId]||(n[o.commitId]={id:o.commitId,date:o.commitDate,email:o.authorEmail,name:o.authorName,message:o.commitMessage,path:o.path});return Object.values(n).sort((o,a)=>a.date.getTime()-o.date.getTime())}),(0,p.Q)(this.destroyed$)).subscribe(e=>{this.commits.next(e);const n=this.selectedCommitControl.value;this.selectedCommit.next(e.find(o=>o.id===n)??null)}),this.selectedCommitControl.valueChanges.pipe((0,$.F)(),(0,p.Q)(this.destroyed$)).subscribe(e=>{const n=this.commits.value.find(o=>o.id===e)??null;n&&(this.selectedCommit.next(n),this.router.navigate([],{relativeTo:this.route,queryParams:{area:"commit","commit-id":e??"head",path:n.path}}))}),this.store.select(I.s.selectedRepository).pipe((0,p.Q)(this.destroyed$)).subscribe(e=>{e||this.router.navigate(["/standard/open-repository"])}),(0,E.z)([this.store.select(I.s.selectedRepository).pipe((0,$.F)((e,n)=>e?.path===n?.path)),this.route.queryParamMap]).pipe((0,f.T)(([e,n])=>({repository:e,area:n.get("area"),commitId:n.get("commit-id"),path:n.get("path")})),(0,D.M)(({commitId:e,path:n})=>{this.selectedCommitControl.setValue("head"===e?null:e,{emitEvent:!0}),this.selectedPath.next(n)}),(0,L.n)(({repository:e,path:n,commitId:o,area:a})=>e&&n&&o?(0,V.p)([this.getPatch(e,n,o,a),this.repositoriesApi.blameFile(e.path,n,"head"===o?void 0:o)]):(0,d.of)(null)),(0,$.F)((e,n)=>{if(!e||!n)return!e&&!n;const[o,a]=e,[l,g]=n;return o&&l?!(o.repositoryPath!==l.repositoryPath||o.isUnstaged!==l.isUnstaged||o.patch.newFileId!==l.patch.newFileId||o.patch.newFileIsDir!==l.patch.newFileIsDir||o.patch.newFileIsSubmodule!==l.patch.newFileIsSubmodule||o.patch.newFilePath!==l.patch.newFilePath||o.patch.oldFileId!==l.patch.oldFileId||o.patch.oldFileIsDir!==l.patch.oldFileIsDir||o.patch.oldFileIsSubmodule!==l.patch.oldFileIsSubmodule||o.patch.oldFilePath!==l.patch.oldFilePath||o.patch.status!==l.patch.status||o.patch.hunks.length!==l.patch.hunks.length||(0,G.A)(o.patch.hunks,l.patch.hunks).some(([m,c])=>m?.lines.length!==c?.lines.length||m?.newStart!==c?.newStart||m?.oldStart!==c?.oldStart||m?.header!==c?.header||m&&c&&(0,G.A)(m.lines,c.lines).some(([r,P])=>r?.content.length!==P?.content.length||r?.newLineNo!==P?.newLineNo||r?.oldLineNo!==P?.oldLineNo||r?.origin!==P?.origin||r?.content!==P?.content))||(0,G.A)(a.hunks,g.hunks).some(([m,c])=>m?.startLineNo!==c?.startLineNo||m?.endLineNo!==c?.endLineNo||m?.authorName!==c?.authorName||m?.authorEmail!==c?.authorEmail||m?.commitId!==c?.commitId||m?.commitMessage!==c?.commitMessage||m?.commitDate!==c?.commitDate||m?.path!==c?.path)):!o&&!l}),(0,L.n)(e=>e&&e[0]?(0,V.p)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!1)).pipe((0,y.W)(n=>u.a_.matches(n)||u.N4.matches(n)?(0,d.of)(null):(0,v.$)(()=>n)),(0,f.T)(n=>n?[e[0],e[1],n]:null)):(0,d.of)(null)),(0,D.M)(e=>{if(e&&e[0]){const[n,o,a]=e;this.blame.next(o),this.diffLines.next({hunks:n.patch.hunks,oldLines:a[0],newLines:a[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,L.n)(e=>e&&e[0]?(0,V.p)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!0)).pipe((0,y.W)(n=>u.a_.matches(n)||u.N4.matches(n)?(0,d.of)(null):(0,v.$)(()=>n)),(0,f.T)(n=>n?[e[0],n]:null)):(0,d.of)(null)),(0,p.Q)(this.destroyed$)).subscribe(e=>{if(e&&e[0]){const[n,o]=e;this.diffLines.next({hunks:n.patch.hunks,oldLines:o[0],newLines:o[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,E.z)([this.store.select(I.s.selectedRepository),this.route.queryParamMap.pipe((0,f.T)(e=>e.get("path")),(0,$.F)())]).pipe((0,L.n)(([e,n])=>e&&n?this.repositoriesApi.blameFile(e.path,n):(0,d.of)(null)),(0,y.W)(()=>(0,d.of)(null)),(0,p.Q)(this.destroyed$)).subscribe(e=>{e&&this.headBlame.next(e)})}getLines(e,n,o,a){if(n.oldFileIsSubmodule||n.newFileIsSubmodule){const l=n.hunks[0]?.lines.find(m=>m.oldLineNo>0),g=n.hunks[0]?.lines.find(m=>m.newLineNo>0);return[(0,d.of)([{lineNumber:1,text:l?.content??"",tokens:[{startIndex:0,endIndex:l?.content.length??0,scopes:["normal"]}]}]),(0,d.of)([{lineNumber:1,text:g?.content??"",tokens:[{startIndex:0,endIndex:g?.content.length??0,scopes:["normal"]}]}])]}return[n.oldFileId?this.highlightApi.getHighlightedFile(e,n.oldFileId,n.oldFilePath,a):(0,d.of)([]),o?this.highlightApi.getHighlightedFile(e,null,n.newFilePath,a):n.newFileId?this.highlightApi.getHighlightedFile(e,n.newFileId,n.newFilePath,a):(0,d.of)([])]}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(F.nX),t.rXU(F.Ix),t.rXU(N.il),t.rXU(tt.m),t.rXU(et.I),t.rXU(nt.M),t.rXU(ot.V))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ng-component"]],features:[t.Vt3],decls:23,vars:19,consts:[[3,"path"],["type","button","mat-icon-button","",1,"jump-to-commit-button","app-icon-button-md",3,"click","matTooltip"],[1,"commit-selector"],["panelClass","commit-select-list",3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["type","button","mat-icon-button","",1,"close-button","app-icon-button-md",3,"click"],[3,"commitChanged","repository","blame","diffLines"],[3,"matTooltip","remotes","email"],[1,"message"],[3,"value"],[1,"commit-select-option"],[1,"message",3,"matTooltip"],[1,"date"]],template:function(n,o){1&n&&(t.j41(0,"header"),t.nrm(1,"app-find-control")(2,"app-condensed-path",0),t.nI1(3,"async"),t.j41(4,"button",1),t.nI1(5,"translate"),t.bIt("click",function(){return o.jumpToSelectedCommit()}),t.j41(6,"mat-icon"),t.EFF(7,"launch"),t.k0s()(),t.j41(8,"mat-form-field",2)(9,"mat-label"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"mat-select",3)(13,"mat-select-trigger"),t.DNE(14,It,5,6,"span",4),t.nI1(15,"async"),t.k0s(),t.DNE(16,Tt,9,12,"mat-option",5),t.nI1(17,"async"),t.k0s()(),t.j41(18,"button",6),t.bIt("click",function(){return o.close()}),t.j41(19,"mat-icon"),t.EFF(20,"close"),t.k0s()()(),t.j41(21,"main")(22,"app-blame-view",7),t.bIt("commitChanged",function(l){return o.selectedCommitControl.setValue(l)}),t.k0s()()),2&n&&(t.R7$(2),t.Y8G("path",t.bMT(3,9,o.selectedPath)),t.R7$(2),t.Y8G("matTooltip",t.bMT(5,11,"Jump to the selected commit")),t.R7$(6),t.JRh(t.bMT(11,13,"Select Commit")),t.R7$(2),t.Y8G("formControl",o.selectedCommitControl),t.R7$(2),t.Y8G("ngIf",t.bMT(15,15,o.selectedCommit)),t.R7$(2),t.Y8G("ngForOf",t.bMT(17,17,o.commits)),t.R7$(6),t.Y8G("repository",o.selectedRepository)("blame",o.blame)("diffLines",o.diffLines))},dependencies:[z.rl,z.nJ,j.VO,j.$2,it.wT,b.Sq,b.bT,S.BC,S.l_,st.iY,W.An,_.oV,k.f,at.A,lt.e,yt,b.Jj,A.J,K.D],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding-top:10px}header[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:baseline;justify-content:space-between;margin-bottom:5px;outline:none;padding:0 10px}header[_ngcontent-%COMP%]   app-condensed-path[_ngcontent-%COMP%]{flex:1 1 auto;min-width:200px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]{width:500px;margin-right:12px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]   mat-select-trigger[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{height:19px;vertical-align:middle;margin-right:5px}header[_ngcontent-%COMP%]   .jump-to-commit-button[_ngcontent-%COMP%], header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{top:-8px}main[_ngcontent-%COMP%]{flex:1 0 auto;outline:none;overflow-x:auto;overflow-y:auto}"],data:{animation:[(0,C.hZ)("slideLeft",[(0,C.kY)(":enter",[(0,C.iF)({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),(0,C.i0)("200ms",(0,C.iF)({transform:"translateX(0)"}))]),(0,C.kY)(":leave",[(0,C.iF)({position:"absolute",top:0,left:0,transform:"translateX(0)"}),(0,C.i0)("200ms",(0,C.iF)({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return(0,q.Cg)([(0,N.l6)(I.s.selectedRepository)],s.prototype,"selectedRepository",void 0),s})()}];let Lt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[F.iI.forChild($t),F.iI]})}}return s})(),wt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[j.Ve,Y.U,H,Lt]})}}return s})()}}]);