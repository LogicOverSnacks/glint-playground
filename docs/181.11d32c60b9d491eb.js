"use strict";(self.webpackChunkgit_glint=self.webpackChunkgit_glint||[]).push([[181],{3178:(Y,L,i)=>{i.d(L,{l:()=>u});var _=i(4080),Z=i(5698),w=i(2722),F=i(9967),t=i(8926),v=i(8310),g=i(4650),$=i(8184);class u extends((0,t.j)(F.A)){constructor(C,f){super(),this.overlay=C,this.viewContainerRef=f,this.overlayRef=null,this.closeMenu=()=>{this.overlayRef?.dispose(),this.overlayRef=null},this.openMenu=(h,p)=>{this.closeMenu(),this.overlayRef=this.overlay.create({positionStrategy:this.overlay.position().flexibleConnectedTo({x:h,y:p}).withPositions([{originX:"end",originY:"bottom",overlayX:"start",overlayY:"top"}])}),this.overlayRef.attach(new _.UE(this.menuTemplate,this.viewContainerRef,{data:this.data})),(0,v.t)(this.overlayRef).pipe((0,Z.q)(1),(0,w.R)(this.destroyed$)).subscribe(this.closeMenu)},this.toggleMenu=(h,p)=>{this.overlayRef?this.closeMenu():this.openMenu(h,p)}}contextmenuListener(C){C.preventDefault(),C.stopPropagation(),this.openMenu(C.x,C.y)}ngOnDestroy(){super.ngOnDestroy(),this.closeMenu()}static{this.\u0275fac=function(f){return new(f||u)(g.Y36($.aV),g.Y36(g.s_b))}}static{this.\u0275dir=g.lG2({type:u,selectors:[["","appContextMenu",""]],hostBindings:function(f,h){1&f&&g.NdJ("contextmenu",function(y){return h.contextmenuListener(y)})},inputs:{menuTemplate:["appContextMenu","menuTemplate"],data:["appContextMenuData","data"]},exportAs:["appContextMenu"],features:[g.qOj]})}}},8310:(Y,L,i)=>{i.d(L,{t:()=>F});var _=i(6451),Z=i(4968),w=i(9300);const F=(t,v=!0)=>(0,_.T)(t.backdropClick(),t.outsidePointerEvents().pipe((0,w.h)(g=>"auxclick"!==g.type)),...v?[(0,Z.R)(t.overlayElement,"click")]:[])},8181:(Y,L,i)=>{i.r(L),i.d(L,{BlameLayoutModule:()=>Q});var _=i(4385),Z=i(3179),w=i(1572),F=i(7072),t=i(4650);class v{static{this.\u0275fac=function(e){return new(e||v)}}static{this.\u0275mod=t.oAB({type:v})}static{this.\u0275inj=t.cJS({imports:[w.Cq,Z.I,F.m]})}}var g=i(2367),$=i(655),u=i(7340),K=i(4006),C=i(9867),f=i(7717),h=i(1135),p=i(9646),y=i(2843),X=i(9841),V=i(4128),M=i(4004),E=i(262),P=i(2722),D=i(1884),W=i(8505),B=i(3900),b=i(2435),H=i(8926),z=i(9967),G=i(2120),A=i(6966),R=i(4889),nt=i(790),ot=i(127),it=i(3058),st=i(7784),k=i(9549),at=i(3238),O=i(6895),lt=i(4859),q=i(7392),tt=i(266),et=i(3051),ct=i(9131),mt=i(3061),J=i(4883),rt=i(4326),pt=i(5698),ht=i(2771),dt=i(315),gt=i(3178),ut=i(744),Ct=i(1899),ft=i(1453);function Mt(l,s){1&l&&(t.TgZ(0,"div",7),t._UZ(1,"mat-spinner"),t._uU(2," Loading...\n"),t.qZA())}function Pt(l,s){if(1&l&&(t.TgZ(0,"span",13)(1,"span",14),t._uU(2),t.qZA(),t._UZ(3,"app-avatar",15),t.ALo(4,"async"),t.TgZ(5,"span",16),t._uU(6),t.qZA(),t.TgZ(7,"span",17),t._uU(8),t.ALo(9,"date"),t.qZA()()),2&l){const e=s.ngIf,n=t.oxw(2),o=t.MAs(11);t.Udp("left",-n.lineNumberMargin-26-400,"px"),t.Q6J("appContextMenu",o)("appContextMenuData",e),t.xp6(1),t.Q6J("matTooltip",e.commitId),t.xp6(1),t.Oqu(e.commitId),t.xp6(1),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(4,12,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(1),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(9,14,e.date,"d MMM y"))}}function Ot(l,s){if(1&l&&(t.TgZ(0,"span",19),t._uU(1),t.qZA()),2&l){const e=s.$implicit;t.Q6J("ngClass",e.class),t.xp6(1),t.Oqu(e.text)}}function xt(l,s){if(1&l&&(t.ynx(0),t.YNc(1,Ot,2,2,"span",18),t.ALo(2,"tokens"),t.ALo(3,"searchToken"),t.ALo(4,"async"),t.BQk()),2&l){const e=s.ngIf,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",t.xi3(2,1,t.Dn7(3,4,e.tokens,e.text,t.lcZ(4,8,n.search)),e.text))}}function vt(l,s){if(1&l&&(t.TgZ(0,"li",8),t.YNc(1,Pt,10,17,"span",9),t.ALo(2,"async"),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"span",11),t._uU(6),t.qZA(),t.YNc(7,xt,5,10,"ng-container",12),t.qZA()),2&l){const e=s.$implicit,n=t.oxw();let o;t.Q6J("ngClass","line-"+e.status),t.xp6(1),t.Q6J("ngIf",null==(o=t.lcZ(2,11,n.blameLines$))?null:o[null==e.newLine?null:e.newLine.lineNumber]),t.xp6(2),t.Udp("right","calc(100% + 26px + "+(n.lineNumberMargin/2).toString()+"px)")("width",n.lineNumberMargin/2-5,"px"),t.xp6(1),t.Oqu(null==e.oldLine?null:e.oldLine.lineNumber),t.xp6(1),t.Udp("width",n.lineNumberMargin/2-5,"px"),t.xp6(1),t.Oqu(null==e.newLine?null:e.newLine.lineNumber),t.xp6(1),t.Q6J("ngIf",n.getLineView(e))}}function yt(l,s){if(1&l){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){const m=t.CHM(e).data,a=t.oxw();return t.KtG(a.copyToClipboard(m.commitId))}),t.TgZ(2,"mat-icon"),t._uU(3,"content_copy"),t.qZA(),t.TgZ(4,"span"),t._uU(5,"Copy Commit ID"),t.qZA()(),t.TgZ(6,"button",21),t.NdJ("click",function(){const m=t.CHM(e).data,a=t.oxw();return t.KtG(a.selectCommit(m.commitId))}),t.TgZ(7,"mat-icon"),t._uU(8,"document_scanner"),t.qZA(),t.TgZ(9,"span"),t._uU(10,"Blame from this Commit"),t.qZA()(),t.TgZ(11,"button",21),t.NdJ("click",function(){const m=t.CHM(e).data,a=t.oxw();return t.KtG(a.jumpToCommit(m.commitId))}),t.TgZ(12,"mat-icon"),t._uU(13,"launch"),t.qZA(),t.TgZ(14,"span"),t._uU(15,"Jump to Commit"),t.qZA()()()}if(2&l){const e=s.data;t.xp6(1),t.Q6J("matTooltip",e.commitId),t.xp6(5),t.Q6J("matTooltip",e.commitId),t.xp6(5),t.Q6J("matTooltip",e.commitId)}}class j extends((0,H.j)(z.A,ht.P)){constructor(s,e,n){super(),this.router=s,this.store=e,this.diffService=n,this.commitChanged=new t.vpe,this.lineNumberMargin=0,this.lines$=new h.X([]),this.blameLines$=new h.X({})}ngOnInit(){this.remotes=this.repository.pipe((0,M.U)(s=>s?.remotes??[])),this.blame.pipe((0,P.R)(this.destroyed$)).subscribe(s=>{if(s){const e=s.hunks.map(n=>[n.startLineNo,{name:n.authorName,email:n.authorEmail,commitId:n.commitId,message:n.commitMessage,date:n.commitDate}]);this.blameLines$.next(Object.fromEntries(e))}else this.blameLines$.next({})}),this.diffLines.pipe((0,rt.g)(0),(0,P.R)(this.destroyed$)).subscribe(s=>{if(s){const e=Math.max(s.oldLines.length,s.newLines.length)??0;this.lineNumberMargin=this.diffService.calculateMargin(e.toString().length),this.diffService.calculateInlineLines(s.oldLines,s.newLines,s.hunks).pipe((0,P.R)(this.destroyed$)).subscribe(n=>{this.lines$.next(n)})}else this.lineNumberMargin=0,this.lines$.next([])})}getLineView(s){return"added"===s.status?s.newLine:"removed"===s.status?s.oldLine:"unchanged"===s.status?s.newLine??s.oldLine:null}trackByDiffLine(s,e){return s}copyToClipboard(s){navigator.clipboard.writeText(s??"")}selectCommit(s){this.commitChanged.next(s)}jumpToCommit(s){this.repository.pipe((0,pt.q)(1),(0,P.R)(this.destroyed$)).subscribe(e=>{if(!e)throw new Error("Cannot jump to commit when no repository is selected");this.store.dispatch([new R.jQ(e.path,s),new R.BK(e.path,s)]).subscribe(()=>{this.router.navigate(["/standard/default"])})})}static{this.\u0275fac=function(e){return new(e||j)(t.Y36(g.F0),t.Y36(C.yh),t.Y36(dt.S))}}static{this.\u0275cmp=t.Xpm({type:j,selectors:[["app-blame-view"]],viewQuery:function(e,n){if(1&e&&t.Gf(J.N7,5),2&e){let o;t.iGM(o=t.CRH())&&(n.viewports=o)}},inputs:{repository:"repository",blame:"blame",diffLines:"diffLines",search:"search"},outputs:{commitChanged:"commitChanged"},features:[t.qOj],decls:12,vars:14,consts:[["class","loading",4,"ngIf"],[1,"viewport",3,"itemSize","maxBufferPx","minBufferPx"],["scrollContainer",""],["tabindex","0",1,"vs-code-theme"],["code",""],["class","line",3,"ngClass",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],["contextMenu",""],[1,"loading"],[1,"line",3,"ngClass"],["class","blame",3,"left","appContextMenu","appContextMenuData",4,"ngIf"],[1,"old-line-number"],[1,"new-line-number"],[4,"ngIf"],[1,"blame",3,"appContextMenu","appContextMenuData"],[1,"commit-id",3,"matTooltip"],[3,"matTooltip","remotes","email"],[1,"message",3,"matTooltip"],[1,"date"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"menu-panel"],[1,"menu-item",3,"matTooltip","click"]],template:function(e,n){1&e&&(t.YNc(0,Mt,3,0,"div",0),t.ALo(1,"nullEmpty"),t.ALo(2,"async"),t.TgZ(3,"cdk-virtual-scroll-viewport",1,2)(5,"code",3,4)(7,"ul"),t.YNc(8,vt,8,13,"li",5),t.ALo(9,"async"),t.qZA()()(),t.YNc(10,yt,16,3,"ng-template",null,6,t.W1O)),2&e&&(t.Q6J("ngIf",!t.lcZ(1,8,t.lcZ(2,10,n.lines$))),t.xp6(3),t.Q6J("itemSize",19)("maxBufferPx",1e3)("minBufferPx",200),t.xp6(4),t.Udp("margin-left",n.lineNumberMargin+26+400+10,"px"),t.xp6(1),t.Q6J("cdkVirtualForOf",t.lcZ(9,12,n.lines$))("cdkVirtualForTrackBy",n.trackByDiffLine))},dependencies:[w.Ou,J.xd,J.x0,J.N7,O.mk,O.sg,O.O5,q.Hw,tt.gM,et.A,gt.l,O.Ov,O.uU,ut.x,Ct.y,ft.U],styles:[".loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;margin:20px;width:100px}code[_ngcontent-%COMP%]{display:block;white-space:pre}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]{position:absolute;width:400px;overflow:hidden;user-select:none;font-size:0;display:flex;justify-content:space-between;align-items:center;gap:5px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{width:16px;height:16px;flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%]{flex:0 0 50px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{flex:1 1 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{position:absolute;text-align:right;user-select:none}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{right:calc(100% + 26px)}.viewport[_ngcontent-%COMP%]{height:100%;width:100%}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#858585}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#5e5e5e}"],changeDetection:0})}}function _t(l,s){if(1&l&&(t.TgZ(0,"span"),t._UZ(1,"app-avatar",9),t.ALo(2,"async"),t.TgZ(3,"span",10),t._uU(4),t.qZA()()),2&l){const e=s.ngIf,n=t.oxw();t.xp6(1),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(2,4,n.remotes))("email",e.email),t.xp6(3),t.Oqu(e.message)}}function Tt(l,s){if(1&l&&(t.TgZ(0,"mat-option",11)(1,"div",12),t._UZ(2,"app-avatar",9),t.ALo(3,"async"),t.TgZ(4,"span",13),t._uU(5),t.qZA(),t.TgZ(6,"span",14),t._uU(7),t.ALo(8,"date"),t.qZA()()()),2&l){const e=s.$implicit,n=t.oxw();t.Q6J("value",e.id),t.xp6(2),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(3,7,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(1),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(8,9,e.date,"d MMM y"))}}const Lt=[{path:"",component:(()=>{class l extends((0,H.j)(z.A)){constructor(e,n,o,m,a,U,r){super(),this.route=e,this.router=n,this.store=o,this.commitsApi=m,this.highlightApi=a,this.repositoriesApi=U,this.routerHistoryService=r,this.blame=new h.X(null),this.headBlame=new h.X(null),this.commits=new h.X([]),this.diffLines=new h.X(null),this.search$=new h.X(null),this.selectedCommitControl=new K.NI(null),this.selectedCommit=new h.X(null),this.selectedPath=new h.X(null),this.previousUrl=null,this.jumpToSelectedCommit=()=>{const c=this.store.selectSnapshot(A.E.selectedRepositoryPath),d=this.selectedCommitControl.value;if(!c)throw new Error("Cannot jump to commit when no repository is selected");if(!d)throw new Error("Cannot jump to commit when no commit is selected");this.store.dispatch([new R.jQ(c,d),new R.BK(c,d)]).subscribe(()=>{this.router.navigate(["/standard/default"])})},this.close=()=>{this.router.navigate([this.previousUrl??"/"])},this.getPatch=(c,d,x,N)=>"head"===x?("staged"===N?c.stagedChanges:"unstaged"===N?c.unstagedChanges:void 0)?.find(T=>T.newFilePath===d)?("staged"===N?this.repositoriesApi.getStagedPatch(c.path,void 0,d):this.repositoriesApi.getUnstagedPatch(c.path,void 0,d)).pipe((0,M.U)(T=>({repositoryPath:c.path,patch:T,isUnstaged:"unstaged"===N})),(0,E.K)(T=>b.vE.matches(T)?(0,y._)(()=>new G.ZR(T.message)):(0,y._)(()=>T))):(0,p.of)(null):"commit"!==N?(0,p.of)(null):this.commitsApi.getPatch(c.path,x,void 0,d).pipe((0,M.U)(I=>({repositoryPath:c.path,patch:I,isUnstaged:!1})),(0,E.K)(I=>b.vE.matches(I)?(0,y._)(()=>new G.ZR(I.message)):(0,y._)(()=>I)))}ngOnInit(){this.previousUrl=this.routerHistoryService.history.length>=2?this.routerHistoryService.history.slice(-2)[0]:null,this.remotes=this.selectedRepository.pipe((0,M.U)(e=>e?.remotes??[])),this.headBlame.pipe((0,M.U)(e=>{if(!e)return[];const n={};for(const o of e.hunks)n[o.commitId]||(n[o.commitId]={id:o.commitId,date:o.commitDate,email:o.authorEmail,name:o.authorName,message:o.commitMessage,path:o.path});return Object.values(n).sort((o,m)=>m.date.getTime()-o.date.getTime())}),(0,P.R)(this.destroyed$)).subscribe(e=>{this.commits.next(e);const n=this.selectedCommitControl.value;this.selectedCommit.next(e.find(o=>o.id===n)??null)}),this.selectedCommitControl.valueChanges.pipe((0,D.x)(),(0,P.R)(this.destroyed$)).subscribe(e=>{const n=this.commits.value.find(o=>o.id===e)??null;n&&(this.selectedCommit.next(n),this.router.navigate([],{relativeTo:this.route,queryParams:{area:"commit","commit-id":e??"head",path:n.path}}))}),this.store.select(A.E.selectedRepository).pipe((0,P.R)(this.destroyed$)).subscribe(e=>{e||this.router.navigate(["/standard/open-repository"])}),(0,X.a)([this.store.select(A.E.selectedRepository).pipe((0,D.x)((e,n)=>e?.path===n?.path)),this.route.queryParamMap]).pipe((0,M.U)(([e,n])=>({repository:e,area:n.get("area"),commitId:n.get("commit-id"),path:n.get("path")})),(0,W.b)(({commitId:e,path:n})=>{this.selectedCommitControl.setValue("head"===e?null:e,{emitEvent:!0}),this.selectedPath.next(n)}),(0,B.w)(({repository:e,path:n,commitId:o,area:m})=>e&&n&&o?(0,V.D)([this.getPatch(e,n,o,m),this.repositoriesApi.blameFile(e.path,n,"head"===o?void 0:o)]):(0,p.of)(null)),(0,D.x)((e,n)=>{if(!e||!n)return!e&&!n;const[o,m]=e,[a,U]=n;return o&&a?!(o.repositoryPath!==a.repositoryPath||o.isUnstaged!==a.isUnstaged||o.patch.newFileId!==a.patch.newFileId||o.patch.newFileIsDir!==a.patch.newFileIsDir||o.patch.newFileIsSubmodule!==a.patch.newFileIsSubmodule||o.patch.newFilePath!==a.patch.newFilePath||o.patch.oldFileId!==a.patch.oldFileId||o.patch.oldFileIsDir!==a.patch.oldFileIsDir||o.patch.oldFileIsSubmodule!==a.patch.oldFileIsSubmodule||o.patch.oldFilePath!==a.patch.oldFilePath||o.patch.status!==a.patch.status||o.patch.hunks.length!==a.patch.hunks.length||(0,f.Z)(o.patch.hunks,a.patch.hunks).some(([r,c])=>r?.lines.length!==c?.lines.length||r?.newStart!==c?.newStart||r?.oldStart!==c?.oldStart||r?.header!==c?.header||r&&c&&(0,f.Z)(r.lines,c.lines).some(([d,x])=>d?.content.length!==x?.content.length||d?.contentOffset!==x?.contentOffset||d?.newLineNo!==x?.newLineNo||d?.oldLineNo!==x?.oldLineNo||d?.origin!==x?.origin||d?.content!==x?.content))||(0,f.Z)(m.hunks,U.hunks).some(([r,c])=>r?.startLineNo!==c?.startLineNo||r?.endLineNo!==c?.endLineNo||r?.authorName!==c?.authorName||r?.authorEmail!==c?.authorEmail||r?.commitId!==c?.commitId||r?.commitMessage!==c?.commitMessage||r?.commitDate!==c?.commitDate||r?.path!==c?.path)):!o&&!a}),(0,B.w)(e=>e&&e[0]?(0,V.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!1)).pipe((0,E.K)(n=>b.OZ.matches(n)||b.hK.matches(n)?(0,p.of)(null):(0,y._)(()=>n)),(0,M.U)(n=>n?[e[0],e[1],n]:null)):(0,p.of)(null)),(0,W.b)(e=>{if(e&&e[0]){const[n,o,m]=e;this.blame.next(o),this.diffLines.next({hunks:n.patch.hunks,oldLines:m[0],newLines:m[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,B.w)(e=>e&&e[0]?(0,V.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!0)).pipe((0,E.K)(n=>b.OZ.matches(n)||b.hK.matches(n)?(0,p.of)(null):(0,y._)(()=>n)),(0,M.U)(n=>n?[e[0],n]:null)):(0,p.of)(null)),(0,P.R)(this.destroyed$)).subscribe(e=>{if(e&&e[0]){const[n,o]=e;this.diffLines.next({hunks:n.patch.hunks,oldLines:o[0],newLines:o[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,X.a)([this.store.select(A.E.selectedRepository),this.route.queryParamMap.pipe((0,M.U)(e=>e.get("path")),(0,D.x)())]).pipe((0,B.w)(([e,n])=>e&&n?this.repositoriesApi.blameFile(e.path,n):(0,p.of)(null)),(0,E.K)(()=>(0,p.of)(null)),(0,P.R)(this.destroyed$)).subscribe(e=>{e&&this.headBlame.next(e)})}getLines(e,n,o,m){if(n.oldFileIsSubmodule||n.newFileIsSubmodule){const a=n.hunks[0].lines.find(r=>r.oldLineNo>0),U=n.hunks[0].lines.find(r=>r.newLineNo>0);return[(0,p.of)([{lineNumber:1,text:a?.content??"",tokens:[{startIndex:0,endIndex:a?.content.length??0,scopes:["normal"]}]}]),(0,p.of)([{lineNumber:1,text:U?.content??"",tokens:[{startIndex:0,endIndex:U?.content.length??0,scopes:["normal"]}]}])]}return[n.oldFileId?this.highlightApi.getHighlightedFile(e,n.oldFileId,n.oldFilePath,m):(0,p.of)([]),o?this.highlightApi.getHighlightedFile(e,null,n.newFilePath,m):n.newFileId?this.highlightApi.getHighlightedFile(e,n.newFileId,n.newFilePath,m):(0,p.of)([])]}static{this.\u0275fac=function(n){return new(n||l)(t.Y36(g.gz),t.Y36(g.F0),t.Y36(C.yh),t.Y36(nt.T),t.Y36(ot.m),t.Y36(it.a),t.Y36(st.X))}}static{this.\u0275cmp=t.Xpm({type:l,selectors:[["ng-component"]],features:[t.qOj],decls:21,vars:14,consts:[[3,"searched"],[3,"path"],["type","button","mat-icon-button","","matTooltip","Jump to the selected commit",1,"jump-to-commit-button","app-icon-button-md",3,"click"],[1,"commit-selector"],["panelClass","commit-select-list",3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["type","button","mat-icon-button","",1,"close-button","app-icon-button-md",3,"click"],[3,"repository","blame","diffLines","search","commitChanged"],[3,"matTooltip","remotes","email"],[1,"message"],[3,"value"],[1,"commit-select-option"],[1,"message",3,"matTooltip"],[1,"date"]],template:function(n,o){1&n&&(t.TgZ(0,"header")(1,"app-find-control",0),t.NdJ("searched",function(a){return o.search$.next(a)}),t.qZA(),t._UZ(2,"app-condensed-path",1),t.ALo(3,"async"),t.TgZ(4,"button",2),t.NdJ("click",function(){return o.jumpToSelectedCommit()}),t.TgZ(5,"mat-icon"),t._uU(6,"launch"),t.qZA()(),t.TgZ(7,"mat-form-field",3)(8,"mat-label"),t._uU(9,"Select Commit"),t.qZA(),t.TgZ(10,"mat-select",4)(11,"mat-select-trigger"),t.YNc(12,_t,5,6,"span",5),t.ALo(13,"async"),t.qZA(),t.YNc(14,Tt,9,12,"mat-option",6),t.ALo(15,"async"),t.qZA()(),t.TgZ(16,"button",7),t.NdJ("click",function(){return o.close()}),t.TgZ(17,"mat-icon"),t._uU(18,"close"),t.qZA()()(),t.TgZ(19,"main")(20,"app-blame-view",8),t.NdJ("commitChanged",function(a){return o.selectedCommitControl.setValue(a)}),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("path",t.lcZ(3,8,o.selectedPath)),t.xp6(8),t.Q6J("formControl",o.selectedCommitControl),t.xp6(2),t.Q6J("ngIf",t.lcZ(13,10,o.selectedCommit)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(15,12,o.commits)),t.xp6(6),t.Q6J("repository",o.selectedRepository)("blame",o.blame)("diffLines",o.diffLines)("search",o.search$))},dependencies:[k.KE,k.hX,_.gD,_.$L,at.ey,O.sg,O.O5,K.JJ,K.oH,lt.RK,q.Hw,tt.gM,et.A,ct.j,mt.T,j,O.Ov,O.uU],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding-top:10px}header[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:baseline;justify-content:space-between;margin-bottom:5px;outline:none;padding:0 10px}header[_ngcontent-%COMP%]   app-condensed-path[_ngcontent-%COMP%]{flex:1 1 auto;min-width:200px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]{width:500px;margin-right:12px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]   mat-select-trigger[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{height:19px;vertical-align:middle;margin-right:5px}header[_ngcontent-%COMP%]   .jump-to-commit-button[_ngcontent-%COMP%], header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{top:-8px}main[_ngcontent-%COMP%]{flex:1 0 auto;outline:none;overflow-x:auto;overflow-y:auto}"],data:{animation:[(0,u.X$)("slideLeft",[(0,u.eR)(":enter",[(0,u.oB)({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),(0,u.jt)("200ms",(0,u.oB)({transform:"translateX(0)"}))]),(0,u.eR)(":leave",[(0,u.oB)({position:"absolute",top:0,left:0,transform:"translateX(0)"}),(0,u.jt)("200ms",(0,u.oB)({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return(0,$.gn)([(0,C.Ph)(A.E.selectedRepository)],l.prototype,"selectedRepository",void 0),l})()}];class S{static{this.\u0275fac=function(e){return new(e||S)}}static{this.\u0275mod=t.oAB({type:S})}static{this.\u0275inj=t.cJS({imports:[g.Bz.forChild(Lt),g.Bz]})}}class Q{static{this.\u0275fac=function(e){return new(e||Q)}}static{this.\u0275mod=t.oAB({type:Q})}static{this.\u0275inj=t.cJS({imports:[_.LD,Z.I,v,S]})}}}}]);