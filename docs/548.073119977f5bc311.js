"use strict";(self.webpackChunkgit_glint=self.webpackChunkgit_glint||[]).push([[548],{3548:($,P,n)=>{n.r(P),n.d(P,{OpenRepositoryLayoutModule:()=>Zt});var y=n(6338),x=n(4385),O=n(3179),d=n(9549),h=n(4144),Z=n(1572),t=n(4650);let _=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.lN,h.c,Z.Cq,x.LD,O.I]}),e})(),I=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.lN,h.c,Z.Cq,O.I]}),e})();var V=n(6093),z=n(3612);let X=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[d.lN,h.c,O.I,V.i,z.e]}),e})();var C=n(7237),k=n(655),s=n(4006),M=n(9253),B=n(591),q=n(6053),A=n(1737),W=n(1059),tt=n(4850),w=n(7625),Y=n(7221),f=n(7545),j=n(537),J=n(1712),b=n(4810),T=n(9967),R=n(1336),u=n(4889),N=n(9077),et=n(9578),F=n(6271),Q=n(3058),ot=n(3238),v=n(6895),U=n(4859),L=n(7392);function nt(e,i){if(1&e&&(t.TgZ(0,"mat-option",11),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",+o.key),t.xp6(1),t.Oqu(o.value.credentialName)}}function it(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"form",2),t.NdJ("ngSubmit",function(){t.CHM(o);const l=t.oxw();return t.KtG(l.clone())}),t.TgZ(1,"mat-form-field",3)(2,"mat-label"),t._uU(3,"URL"),t.qZA(),t.TgZ(4,"mat-icon",4),t._uU(5,"public"),t.qZA(),t._UZ(6,"input",5),t.qZA(),t.TgZ(7,"mat-form-field",6),t.NdJ("click",function(){t.CHM(o);const l=t.oxw();return t.KtG(l.browsePathIfEmpty())}),t.TgZ(8,"mat-label"),t._uU(9,"Path to clone to"),t.qZA(),t.TgZ(10,"mat-icon",4),t._uU(11,"folder"),t.qZA(),t._UZ(12,"input",7),t.TgZ(13,"button",8),t.NdJ("click",function(l){return t.CHM(o),t.oxw().browsePath(),t.KtG(l.stopPropagation())}),t._uU(14,"Browse"),t.qZA()(),t.TgZ(15,"mat-form-field",9)(16,"mat-label"),t._uU(17,"Credential"),t.qZA(),t.TgZ(18,"mat-icon",4),t._uU(19,"key"),t.qZA(),t.TgZ(20,"mat-select",10)(21,"mat-option",11),t._uU(22,"None"),t.qZA(),t.YNc(23,nt,2,2,"mat-option",12),t.ALo(24,"keyvalue"),t.ALo(25,"async"),t.qZA()(),t.TgZ(26,"button",13),t._uU(27,"Clone"),t.qZA()()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(21),t.Q6J("value",null),t.xp6(2),t.Q6J("ngForOf",t.lcZ(24,4,t.lcZ(25,6,o.validCredentials))),t.xp6(3),t.Q6J("disabled",o.form.invalid)}}function rt(e,i){1&e&&(t.TgZ(0,"div",14),t._UZ(1,"mat-spinner"),t._uU(2," Cloning...\n"),t.qZA())}let st=(()=>{class e extends((0,b.j)(T.A)){constructor(o,a,l,r){super(),this.router=o,this.store=a,this.filesApi=l,this.repositoriesApi=r,this.cloning=new B.X(!1),this.form=new s.cw({url:new s.NI(null,s.kI.required),path:new s.NI(null,s.kI.required),credential:new s.NI(null)}),this.validCredentials=(0,q.aj)([this.allCredentials,this.form.controls.url.valueChanges.pipe((0,W.O)(null))]).pipe((0,tt.U)(([c,m])=>{const g=[...c.entries()];return Object.fromEntries(m?/^https?:\/\//.test(m)?g.filter(([E,p])=>"password"===p.type):/^(git|file)?:\/\//.test(m)||/^\//.test(m)||!/:/.test(m)?[]:g.filter(([E,p])=>"ssh"===p.type):g)})),this.browsePath=()=>{this.filesApi.openFolderDialog().pipe((0,w.R)(this.destroyed$)).subscribe(c=>{c&&this.form.controls.path.setValue(c)})},this.browsePathIfEmpty=()=>{this.form.controls.path.value||this.browsePath()},this.clone=()=>{if(this.cloning.value)throw new Error("Already cloning");const{url:c,path:m,credential:g}=this.form.value;if(!c)throw new Error("Cannot clone repository with no url");if(!m)throw new Error("Cannot clone repository with no local path");const E=this.store.selectSnapshot(N.$.credentials);this.cloning.next(!0),this.repositoriesApi.cloneRepository(c,m,g?E.get(g):void 0).pipe((0,Y.K)(p=>J.Ay.matches(p)||J.T0.matches(p)||J.o8.matches(p)?this.store.dispatch(new R.NN("error",p.message)).pipe((0,f.w)(()=>(0,A._)(p))):this.store.dispatch(new R.NN("unhandled",`${p}`)).pipe((0,f.w)(()=>(0,A._)(p)))),(0,f.w)(()=>this.store.dispatch(new u.gz(m))),(0,f.w)(()=>{const p=this.store.selectSnapshot(N.$.selectedProfile),S=g&&"all"!==p?.credentialIds&&!p?.credentialIds.includes(g)?0:this.store.selectSnapshot(N.$.selectedProfileId),_t=g?{remotes:{origin:{credentialId:g}}}:null;return p&&S>0&&"all"!==p.allowedRepositories&&this.store.dispatch(new et.Bu(S,{...p,allowedRepositories:[...p.allowedRepositories,m]})),this.store.dispatch(new u.xs(m,S,_t))}),(0,f.w)(()=>this.store.dispatch(new u.he(m))),(0,f.w)(()=>this.store.dispatch(new u.BZ(m))),(0,j.x)(()=>{this.cloning.next(!1)}),(0,w.R)(this.destroyed$)).subscribe(()=>{this.router.navigate(["/"])})}}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(C.F0),t.Y36(M.yh),t.Y36(F.k),t.Y36(Q.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-clone-repository-view"]],features:[t.qOj],decls:4,vars:6,consts:[[3,"formGroup","ngSubmit",4,"ngIf"],["class","cloning",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"url"],["matPrefix",""],["type","text","matInput","","required","","formControlName","url"],[1,"path",3,"click"],["type","text","matInput","","required","","formControlName","path"],["type","button","matSuffix","","mat-button","",3,"click"],[1,"credential"],["formControlName","credential","placeholder","Select credential"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],[1,"cloning"]],template:function(o,a){1&o&&(t.YNc(0,it,28,8,"form",0),t.ALo(1,"async"),t.YNc(2,rt,3,0,"div",1),t.ALo(3,"async")),2&o&&(t.Q6J("ngIf",!1===t.lcZ(1,2,a.cloning)),t.xp6(2),t.Q6J("ngIf",t.lcZ(3,4,a.cloning)))},dependencies:[d.KE,d.hX,d.qo,d.R9,h.Nt,Z.Ou,x.gD,ot.ey,v.sg,v.O5,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,U.lW,L.Hw,v.Ov,v.Nd],styles:["form[_ngcontent-%COMP%]{margin:10px;max-width:500px}form[_ngcontent-%COMP%]   .url[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .credential[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]     .mat-form-field-prefix{margin-right:10px}form[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%]     .mat-form-field-suffix{top:-.25em}.cloning[_ngcontent-%COMP%]{margin:10px;font-size:24px}.cloning[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-bottom:20px}"],changeDetection:0}),(0,k.gn)([(0,M.Ph)(N.$.credentials)],e.prototype,"allCredentials",void 0),e})();function at(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"form",2),t.NdJ("ngSubmit",function(){t.CHM(o);const l=t.oxw();return t.KtG(l.create())}),t.TgZ(1,"mat-form-field",3),t.NdJ("click",function(l){t.CHM(o);const r=t.oxw();return t.KtG(r.browsePathIfEmpty(l))}),t.TgZ(2,"mat-label"),t._uU(3,"Path to create in"),t.qZA(),t.TgZ(4,"mat-icon",4),t._uU(5,"folder"),t.qZA(),t._UZ(6,"input",5),t.TgZ(7,"button",6),t.NdJ("click",function(l){t.CHM(o);const r=t.oxw();return t.KtG(r.browsePath(l))}),t._uU(8,"Browse"),t.qZA()(),t.TgZ(9,"mat-form-field",7)(10,"mat-label"),t._uU(11,"Default branch"),t.qZA(),t._UZ(12,"mat-icon",8)(13,"input",9),t.qZA(),t.TgZ(14,"button",10),t._uU(15,"Create"),t.qZA()()}if(2&e){const o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(14),t.Q6J("disabled",o.form.invalid)}}function lt(e,i){1&e&&(t.TgZ(0,"div",11),t._UZ(1,"mat-spinner"),t._uU(2," Cloning...\n"),t.qZA())}let pt=(()=>{class e extends((0,b.j)(T.A)){constructor(o,a,l,r){super(),this.router=o,this.store=a,this.filesApi=l,this.repositoriesApi=r,this.creating=new B.X(!1),this.form=new s.cw({path:new s.NI(null,s.kI.required),defaultBranch:new s.NI("main",{nonNullable:!0})}),this.browsePath=c=>{c.preventDefault(),c.stopPropagation(),this.filesApi.openFolderDialog().pipe((0,w.R)(this.destroyed$)).subscribe(m=>{m&&this.form.controls.path.setValue(m)})},this.browsePathIfEmpty=c=>{this.form.controls.path.value||this.browsePath(c)},this.create=()=>{if(this.creating.value)throw new Error("Already creating");const{path:c,defaultBranch:m}=this.form.value;if(!c)throw new Error("Cannot create repository with no local path");this.creating.next(!0),this.repositoriesApi.createRepository(c,m??"main").pipe((0,Y.K)(g=>this.store.dispatch(new R.NN("unhandled",`${g}`)).pipe((0,f.w)(()=>(0,A._)(g)))),(0,f.w)(()=>this.store.dispatch(new u.gz(c))),(0,f.w)(()=>this.store.dispatch(new u.he(c))),(0,f.w)(()=>this.store.dispatch(new u.BZ(c))),(0,j.x)(()=>{this.creating.next(!1)}),(0,w.R)(this.destroyed$)).subscribe(()=>{this.router.navigate(["/"])})}}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(C.F0),t.Y36(M.yh),t.Y36(F.k),t.Y36(Q.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-create-repository-view"]],features:[t.qOj],decls:4,vars:6,consts:[[3,"formGroup","ngSubmit",4,"ngIf"],["class","cloning",4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"path",3,"click"],["matPrefix",""],["type","text","matInput","","required","","formControlName","path"],["type","button","matSuffix","","mat-button","",3,"click"],[1,"default-branch"],["matPrefix","","svgIcon","source-branch"],["type","text","placeholder","main","matInput","","formControlName","defaultBranch"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],[1,"cloning"]],template:function(o,a){1&o&&(t.YNc(0,at,16,2,"form",0),t.ALo(1,"async"),t.YNc(2,lt,3,0,"div",1),t.ALo(3,"async")),2&o&&(t.Q6J("ngIf",!1===t.lcZ(1,2,a.creating)),t.xp6(2),t.Q6J("ngIf",t.lcZ(3,4,a.creating)))},dependencies:[d.KE,d.hX,d.qo,d.R9,h.Nt,Z.Ou,v.O5,s._Y,s.Fj,s.JJ,s.JL,s.Q7,s.sg,s.u,U.lW,L.Hw,v.Ov],styles:["form[_ngcontent-%COMP%]{margin:10px;max-width:500px}form[_ngcontent-%COMP%]   .path[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .default-branch[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]     .mat-form-field-prefix{margin-right:10px}form[_ngcontent-%COMP%]     .mat-form-field-suffix{top:-.25em}"],changeDetection:0}),e})();var ct=n(6197),K=n(9251),D=n(3546),G=n(5724),H=n(3943),mt=n(5174),dt=n(744);function ft(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(o);const l=t.oxw(2);return t.KtG(l.searchControl.setValue(null))}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA()()}}function ut(e,i){if(1&e&&(t.TgZ(0,"mat-form-field",7)(1,"mat-label"),t._uU(2,"Search"),t.qZA(),t.TgZ(3,"span",8)(4,"mat-icon"),t._uU(5,"search"),t.qZA(),t._uU(6,"\xa0"),t.qZA(),t._UZ(7,"input",9),t.YNc(8,ft,3,0,"button",10),t.qZA()),2&e){const o=t.oxw();t.xp6(7),t.Q6J("formControl",o.searchControl),t.xp6(1),t.Q6J("ngIf",o.searchControl.value)}}function ht(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"mat-card")(1,"mat-card-title")(2,"mat-icon"),t._uU(3,"history"),t.qZA(),t._uU(4," Recently opened"),t.qZA(),t.TgZ(5,"mat-card-content")(6,"app-repository-history-view",12),t.NdJ("clicked",function(l){t.CHM(o);const r=t.oxw();return t.KtG(r.openRecent(l))})("dragStarted",function(l){t.CHM(o);const r=t.oxw();return t.KtG(r.dragstartListener(l[0],l[1]))}),t.qZA()()()}}let gt=(()=>{class e extends((0,b.j)(T.A)){constructor(o,a,l){super(),this.router=o,this.store=a,this.filesApi=l,this.searchControl=new s.NI(null),this.openBookmark=r=>{(0,K.b)(r)||this.store.dispatch(new u.he(r.id)).pipe((0,f.w)(()=>this.store.dispatch(new u.BZ(r.id))),(0,w.R)(this.destroyed$)).subscribe(()=>{this.router.navigate(["/"])})},this.openRecent=r=>{this.store.dispatch(new u.he(r)).pipe((0,f.w)(()=>this.store.dispatch(new u.BZ(r))),(0,w.R)(this.destroyed$)).subscribe(()=>{this.router.navigate(["/"])})},this.openFromDisk=()=>{this.filesApi.openFolderDialog().pipe((0,w.R)(this.destroyed$)).subscribe(r=>{r&&this.store.dispatch(new u.gz(r)).pipe((0,f.w)(()=>this.store.dispatch(new u.he(r))),(0,f.w)(()=>this.store.dispatch(new u.BZ(r))),(0,w.R)(this.destroyed$)).subscribe(()=>{this.router.navigate(["/"])})})},this.dragstartListener=(r,c)=>{r.dataTransfer&&(r.dataTransfer.setData("app/repository",c),r.dataTransfer.effectAllowed="move")}}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(C.F0),t.Y36(M.yh),t.Y36(F.k))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-open-repository-view"]],features:[t.qOj],decls:20,vars:6,consts:[["type","button","mat-flat-button","",1,"open-from-disk-button",3,"click"],["class","search-box",4,"ngIf"],["id","open-repository-view"],["min","210px"],[3,"nodeClick"],["min","300px"],[4,"ngIf"],[1,"search-box"],["matPrefix",""],["matInput","","type","text",3,"formControl"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["matSuffix","","mat-icon-button","",3,"click"],[3,"clicked","dragStarted"]],template:function(o,a){1&o&&(t.TgZ(0,"header")(1,"button",0),t.NdJ("click",function(){return a.openFromDisk()}),t.TgZ(2,"mat-icon"),t._uU(3,"folder_open"),t.qZA(),t._uU(4," Open from disk "),t.qZA(),t.YNc(5,ut,9,2,"mat-form-field",1),t.qZA(),t.TgZ(6,"main")(7,"app-grid",2)(8,"app-grid-cell",3)(9,"mat-card")(10,"mat-card-title")(11,"mat-icon"),t._uU(12,"bookmarks"),t.qZA(),t._uU(13," Bookmarks"),t.qZA(),t.TgZ(14,"mat-card-content")(15,"app-repository-bookmarks-view",4),t.NdJ("nodeClick",function(r){return a.openBookmark(r)}),t.qZA()()()(),t.TgZ(16,"app-grid-cell",5),t.YNc(17,ht,7,0,"mat-card",6),t.ALo(18,"nullEmpty"),t.ALo(19,"async"),t.qZA()()()),2&o&&(t.xp6(5),t.Q6J("ngIf",!1),t.xp6(12),t.Q6J("ngIf",t.lcZ(18,2,t.lcZ(19,4,a.recentRepositories))))},dependencies:[d.KE,d.hX,d.qo,d.R9,h.Nt,v.O5,s.Fj,s.JJ,s.oH,U.lW,D.a8,D.dn,D.n5,L.Hw,G.Y,H.M,K.j,mt.J,v.Ov,dt.x],styles:["header[_ngcontent-%COMP%]{margin:10px 10px 0;display:flex;align-items:baseline}header[_ngcontent-%COMP%]   .open-from-disk-button[_ngcontent-%COMP%]{margin-bottom:26px}header[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{flex:auto;margin-left:10px}main[_ngcontent-%COMP%]{padding:0 5px 10px}main[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{margin:0 5px}"],changeDetection:0}),(0,k.gn)([(0,M.Ph)(ct.E.recentRepositories)],e.prototype,"recentRepositories",void 0),e})();var yt=n(4745);const Ct=function(){return["./open"]},wt=function(){return["./clone"]},vt=function(){return["./create"]},xt=[{path:"",component:(()=>{class e extends((0,b.j)(T.A,yt.H)){}return e.\u0275fac=function(){let i;return function(a){return(i||(i=t.n5z(e)))(a||e)}}(),e.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],features:[t.qOj],decls:12,vars:6,consts:[[1,"mat-app-background"],["id","open-repository-layout"],["min","150px"],[1,"links"],["routerLinkActive","active",3,"routerLink"],["min","510px"]],template:function(o,a){1&o&&(t.TgZ(0,"main",0)(1,"app-grid",1)(2,"app-grid-cell",2)(3,"mat-list",3)(4,"mat-list-item",4),t._uU(5,"Open"),t.qZA(),t.TgZ(6,"mat-list-item",4),t._uU(7,"Clone"),t.qZA(),t.TgZ(8,"mat-list-item",4),t._uU(9,"Create"),t.qZA()()(),t.TgZ(10,"app-grid-cell",5),t._UZ(11,"router-outlet"),t.qZA()()()),2&o&&(t.xp6(4),t.Q6J("routerLink",t.DdM(3,Ct)),t.xp6(2),t.Q6J("routerLink",t.DdM(4,wt)),t.xp6(2),t.Q6J("routerLink",t.DdM(5,vt)))},dependencies:[y.i$,y.Tg,G.Y,H.M,C.lC,C.rH,C.Od],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}.dark-theme[_nghost-%COMP%]   header[_ngcontent-%COMP%]{border-bottom-color:#ffffff1f}header[_ngcontent-%COMP%]{display:flex;border-bottom:1px solid transparent}header[_ngcontent-%COMP%]   app-repository-tabs-view[_ngcontent-%COMP%]{flex:1 0 auto}header[_ngcontent-%COMP%]   app-repository-tabs-view[_ngcontent-%COMP%]     .mat-tab-nav-bar{border:none}header[_ngcontent-%COMP%]   .settings-icon[_ngcontent-%COMP%]{margin:12px;cursor:pointer}main[_ngcontent-%COMP%]{height:100%;overflow:hidden}main[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]{padding-top:0}main[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{outline:none;cursor:pointer}main[_ngcontent-%COMP%]   .links[_ngcontent-%COMP%]   mat-list-item.active[_ngcontent-%COMP%]{background:#78909c}"],changeDetection:0}),e})(),children:[{path:"open",component:gt},{path:"clone",component:st},{path:"create",component:pt},{path:"",redirectTo:"open",pathMatch:"full"}]}];let Ot=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.Bz.forChild(xt),C.Bz]}),e})(),Zt=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[y.ie,x.LD,O.I,_,I,X,Ot]}),e})()},6271:($,P,n)=>{n.d(P,{k:()=>d});var y=n(3779),x=n(4650),O=n(1040);let d=(()=>{class h{constructor(t){this.baseApi=t}getRelativePath(t,_){return this.baseApi.single(y.w.files.getRelativePath,t,_)}getFileContents(t){return this.baseApi.single(y.w.files.getFileContents,t)}getFileDiff(t,_,I,V){return this.baseApi.single(y.w.files.getFileDiff,t,_,I,V)}openFileDialog(){return this.baseApi.single(y.w.files.openFileDialog)}openFolderDialog(t){return this.baseApi.single(y.w.files.openFolderDialog,t)}}return h.\u0275fac=function(t){return new(t||h)(x.LFG(O._))},h.\u0275prov=x.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()}}]);