"use strict";(self.webpackChunkgit_glint=self.webpackChunkgit_glint||[]).push([[623],{4623:(wt,Q,i)=>{i.r(Q),i.d(Q,{BlameLayoutModule:()=>Zt});var _=i(8525),S=i(1345),$=i(5940),H=i(8700),t=i(5879);let W=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[$.Cq,S.I,H.m]})}}return s})();var L=i(3897),q=i(7582),h=i(6825),A=i(6223),N=i(4666),U=i(9738),u=i(5619),r=i(2096),O=i(8504),j=i(2572),J=i(9315),C=i(7398),Z=i(6306),f=i(9773),T=i(3997),R=i(9397),b=i(4664),d=i(3153),V=i(4573),D=i(7910),B=i(751),w=i(2401),F=i(4214),k=i(2718),tt=i(7735),et=i(7361),X=i(4170),nt=i(3680),x=i(6814),ot=i(2296),Y=i(617),E=i(2596),K=i(1102),it=i(4551),st=i(680),I=i(7368),at=i(7547),lt=i(8180),ct=i(1361),mt=i(4794),rt=i(6275),pt=i(6885),z=i(2415),G=i(7484),gt=i(7041),dt=i(6974);function ht(s,p){1&s&&(t.TgZ(0,"div",7),t._UZ(1,"mat-spinner"),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&s&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"Loading..."),"\n"))}function ut(s,p){if(1&s&&(t.TgZ(0,"span",13)(1,"span",14),t._uU(2),t.qZA(),t._UZ(3,"app-avatar",15),t.ALo(4,"async"),t.TgZ(5,"span",16),t._uU(6),t.qZA(),t.TgZ(7,"span",17),t._uU(8),t.ALo(9,"translateDate"),t.qZA()()),2&s){const e=p.ngIf,n=t.oxw(2),o=t.MAs(11);t.Udp("left",-n.lineNumberMargin-26-400,"px"),t.Q6J("appContextMenu",o)("appContextMenuData",e),t.xp6(1),t.Q6J("matTooltip",e.commitId),t.xp6(1),t.Oqu(e.commitId),t.xp6(1),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(4,12,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(1),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(9,14,e.date,"mediumDate"))}}function Ct(s,p){if(1&s&&(t.TgZ(0,"span",19),t._uU(1),t.qZA()),2&s){const e=p.$implicit;t.Q6J("ngClass",e.class),t.xp6(1),t.Oqu(e.text)}}function ft(s,p){if(1&s&&(t.ynx(0),t.YNc(1,Ct,2,2,"span",18),t.ALo(2,"tokens"),t.ALo(3,"searchToken"),t.ALo(4,"async"),t.BQk()),2&s){const e=p.ngIf,n=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",t.xi3(2,1,t.Dn7(3,4,e.tokens,e.text,t.lcZ(4,8,n.search)),e.text))}}function Pt(s,p){if(1&s&&(t.TgZ(0,"li",8),t.YNc(1,ut,10,17,"span",9),t.ALo(2,"async"),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"span",11),t._uU(6),t.qZA(),t.YNc(7,ft,5,10,"ng-container",12),t.qZA()),2&s){const e=p.$implicit,n=t.oxw();let o;t.Q6J("ngClass","line-"+e.status),t.xp6(1),t.Q6J("ngIf",null==(o=t.lcZ(2,11,n.blameLines$))?null:o[null==e.newLine?null:e.newLine.lineNumber]),t.xp6(2),t.Udp("right","calc(100% + 26px + "+(n.lineNumberMargin/2).toString()+"px)")("width",n.lineNumberMargin/2-5,"px"),t.xp6(1),t.Oqu(null==e.oldLine?null:e.oldLine.lineNumber),t.xp6(1),t.Udp("width",n.lineNumberMargin/2-5,"px"),t.xp6(1),t.Oqu(null==e.newLine?null:e.newLine.lineNumber),t.xp6(1),t.Q6J("ngIf",n.getLineView(e))}}function Mt(s,p){if(1&s){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){const c=t.CHM(e).data,l=t.oxw();return t.KtG(l.copyToClipboard(c.commitId))}),t.TgZ(2,"mat-icon"),t._uU(3,"content_copy"),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"button",21),t.NdJ("click",function(){const c=t.CHM(e).data,l=t.oxw();return t.KtG(l.selectCommit(c.commitId))}),t.TgZ(8,"mat-icon"),t._uU(9,"document_scanner"),t.qZA(),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"button",21),t.NdJ("click",function(){const c=t.CHM(e).data,l=t.oxw();return t.KtG(l.jumpToCommit(c.commitId))}),t.TgZ(14,"mat-icon"),t._uU(15,"launch"),t.qZA(),t.TgZ(16,"span"),t._uU(17),t.ALo(18,"translate"),t.qZA()()()}if(2&s){const e=p.data;t.xp6(1),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(6,6,"Copy Commit ID")),t.xp6(2),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(12,8,"Blame from this Commit")),t.xp6(2),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(18,10,"Jump to Commit"))}}let Ot=(()=>{class s extends((0,V.j)(D.A,ct.P)){constructor(e,n,o){super(),this.router=e,this.store=n,this.diffService=o,this.commitChanged=new t.vpe,this.lineNumberMargin=0,this.lines$=new u.X([]),this.blameLines$=new u.X({})}ngOnInit(){this.remotes=this.repository.pipe((0,C.U)(e=>e?.remotes??[])),this.blame.pipe((0,f.R)(this.destroyed$)).subscribe(e=>{if(e){const n=e.hunks.map(o=>[o.startLineNo,{name:o.authorName,email:o.authorEmail,commitId:o.commitId,message:o.commitMessage,date:o.commitDate}]);this.blameLines$.next(Object.fromEntries(n))}else this.blameLines$.next({})}),this.diffLines.pipe((0,at.g)(0),(0,f.R)(this.destroyed$)).subscribe(e=>{if(e){const n=Math.max(e.oldLines.length,e.newLines.length)??0;this.lineNumberMargin=this.diffService.calculateMargin(n.toString().length),this.diffService.calculateInlineLines(e.oldLines,e.newLines,e.hunks).pipe((0,f.R)(this.destroyed$)).subscribe(o=>{this.lines$.next(o)})}else this.lineNumberMargin=0,this.lines$.next([])})}getLineView(e){return"added"===e.status?e.newLine:"removed"===e.status?e.oldLine:"unchanged"===e.status?e.newLine??e.oldLine:null}trackByDiffLine(e,n){return e}copyToClipboard(e){navigator.clipboard.writeText(e??"")}selectCommit(e){this.commitChanged.next(e)}jumpToCommit(e){this.repository.pipe((0,lt.q)(1),(0,f.R)(this.destroyed$)).subscribe(n=>{if(!n)throw new d.Ys;this.store.dispatch([new F.jQ(n.path,e),new F.BK(n.path,e)]).subscribe(()=>{this.router.navigate(["/standard/default"])})})}static{this.\u0275fac=function(n){return new(n||s)(t.Y36(L.F0),t.Y36(N.yh),t.Y36(mt.S))}}static{this.\u0275cmp=t.Xpm({type:s,selectors:[["app-blame-view"]],viewQuery:function(n,o){if(1&n&&t.Gf(I.N7,5),2&n){let c;t.iGM(c=t.CRH())&&(o.viewports=c)}},inputs:{repository:"repository",blame:"blame",diffLines:"diffLines",search:"search"},outputs:{commitChanged:"commitChanged"},features:[t.qOj],decls:12,vars:14,consts:[["class","loading",4,"ngIf"],[1,"viewport",3,"itemSize","maxBufferPx","minBufferPx"],["scrollContainer",""],["tabindex","0",1,"vs-code-theme"],["code",""],["class","line",3,"ngClass",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],["contextMenu",""],[1,"loading"],[1,"line",3,"ngClass"],["class","blame",3,"left","appContextMenu","appContextMenuData",4,"ngIf"],[1,"old-line-number"],[1,"new-line-number"],[4,"ngIf"],[1,"blame",3,"appContextMenu","appContextMenuData"],[1,"commit-id",3,"matTooltip"],[3,"matTooltip","remotes","email"],[1,"message",3,"matTooltip"],[1,"date"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"menu-panel"],[1,"menu-item",3,"matTooltip","click"]],template:function(n,o){1&n&&(t.YNc(0,ht,4,3,"div",0),t.ALo(1,"nullEmpty"),t.ALo(2,"async"),t.TgZ(3,"cdk-virtual-scroll-viewport",1,2)(5,"code",3,4)(7,"ul"),t.YNc(8,Pt,8,13,"li",5),t.ALo(9,"async"),t.qZA()()(),t.YNc(10,Mt,19,12,"ng-template",null,6,t.W1O)),2&n&&(t.Q6J("ngIf",!t.lcZ(1,8,t.lcZ(2,10,o.lines$))),t.xp6(3),t.Q6J("itemSize",19)("maxBufferPx",1e3)("minBufferPx",200),t.xp6(4),t.Udp("margin-left",o.lineNumberMargin+26+400+10,"px"),t.xp6(1),t.Q6J("cdkVirtualForOf",t.lcZ(9,12,o.lines$))("cdkVirtualForTrackBy",o.trackByDiffLine))},dependencies:[$.Ou,I.xd,I.x0,I.N7,x.mk,x.sg,x.O5,Y.Hw,E.gM,K.A,rt.l,x.Ov,pt.x,z.v,G.X,gt.y,dt.U],styles:[".loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;margin:20px;width:100px}code[_ngcontent-%COMP%]{display:block;white-space:pre}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]{position:absolute;width:400px;overflow:hidden;user-select:none;font-size:0;display:flex;justify-content:space-between;align-items:center;gap:5px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{width:16px;height:16px;flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:1rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%]{flex:0 0 50px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{flex:1 1 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{position:absolute;text-align:right;user-select:none}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{right:calc(100% + 26px)}.viewport[_ngcontent-%COMP%]{height:100%;width:100%}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#858585}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#5e5e5e}"],changeDetection:0})}}return s})();function xt(s,p){if(1&s&&(t.TgZ(0,"span"),t._UZ(1,"app-avatar",9),t.ALo(2,"async"),t.TgZ(3,"span",10),t._uU(4),t.qZA()()),2&s){const e=p.ngIf,n=t.oxw();t.xp6(1),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(2,4,n.remotes))("email",e.email),t.xp6(3),t.Oqu(e.message)}}function vt(s,p){if(1&s&&(t.TgZ(0,"mat-option",11)(1,"div",12),t._UZ(2,"app-avatar",9),t.ALo(3,"async"),t.TgZ(4,"span",13),t._uU(5),t.qZA(),t.TgZ(6,"span",14),t._uU(7),t.ALo(8,"translateDate"),t.qZA()()()),2&s){const e=p.$implicit,n=t.oxw();t.Q6J("value",e.id),t.xp6(2),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(3,7,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(1),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(8,9,e.date,"mediumDate"))}}const yt=[{path:"",component:(()=>{class s extends((0,V.j)(D.A)){constructor(e,n,o,c,l,y){super(),this.route=e,this.router=n,this.store=o,this.commitsApi=c,this.highlightApi=l,this.repositoriesApi=y,this.blame=new u.X(null),this.headBlame=new u.X(null),this.commits=new u.X([]),this.diffLines=new u.X(null),this.search$=new u.X(null),this.selectedCommitControl=new A.NI(null),this.selectedCommit=new u.X(null),this.selectedPath=new u.X(null),this.jumpToSelectedCommit=()=>{const a=this.store.selectSnapshot(w.E.selectedRepositoryPath),m=this.selectedCommitControl.value;if(!a)throw new d.Ys;if(!m)throw new d.j8;this.store.dispatch([new F.jQ(a,m),new F.BK(a,m)]).subscribe(()=>{this.router.navigate(["/standard/default"])})},this.close=()=>{history.back()},this.getPatch=(a,m,P,g)=>"head"===P?("staged"===g?a.stagedChanges:"unstaged"===g?a.unstagedChanges:void 0)?.find(v=>v.newFilePath===m)?("staged"===g?this.repositoriesApi.getStagedPatch(a.path,void 0,m):this.repositoriesApi.getUnstagedPatch(a.path,void 0,m)).pipe((0,C.U)(v=>({repositoryPath:a.path,patch:v,isUnstaged:"unstaged"===g})),(0,Z.K)(v=>d.vE.matches(v)?(0,O._)(()=>new B.ZR(v)):(0,O._)(()=>v))):(0,r.of)(null):"commit"!==g?(0,r.of)(null):this.commitsApi.getPatch(a.path,P,void 0,m).pipe((0,C.U)(M=>({repositoryPath:a.path,patch:M,isUnstaged:!1})),(0,Z.K)(M=>d.ik.matches(M)||d.vE.matches(M)?(0,O._)(()=>new B.ZR(M)):(0,O._)(()=>M)))}ngOnInit(){this.remotes=this.selectedRepository.pipe((0,C.U)(e=>e?.remotes??[])),this.headBlame.pipe((0,C.U)(e=>{if(!e)return[];const n={};for(const o of e.hunks)n[o.commitId]||(n[o.commitId]={id:o.commitId,date:o.commitDate,email:o.authorEmail,name:o.authorName,message:o.commitMessage,path:o.path});return Object.values(n).sort((o,c)=>c.date.getTime()-o.date.getTime())}),(0,f.R)(this.destroyed$)).subscribe(e=>{this.commits.next(e);const n=this.selectedCommitControl.value;this.selectedCommit.next(e.find(o=>o.id===n)??null)}),this.selectedCommitControl.valueChanges.pipe((0,T.x)(),(0,f.R)(this.destroyed$)).subscribe(e=>{const n=this.commits.value.find(o=>o.id===e)??null;n&&(this.selectedCommit.next(n),this.router.navigate([],{relativeTo:this.route,queryParams:{area:"commit","commit-id":e??"head",path:n.path}}))}),this.store.select(w.E.selectedRepository).pipe((0,f.R)(this.destroyed$)).subscribe(e=>{e||this.router.navigate(["/standard/open-repository"])}),(0,j.a)([this.store.select(w.E.selectedRepository).pipe((0,T.x)((e,n)=>e?.path===n?.path)),this.route.queryParamMap]).pipe((0,C.U)(([e,n])=>({repository:e,area:n.get("area"),commitId:n.get("commit-id"),path:n.get("path")})),(0,R.b)(({commitId:e,path:n})=>{this.selectedCommitControl.setValue("head"===e?null:e,{emitEvent:!0}),this.selectedPath.next(n)}),(0,b.w)(({repository:e,path:n,commitId:o,area:c})=>e&&n&&o?(0,J.D)([this.getPatch(e,n,o,c),this.repositoriesApi.blameFile(e.path,n,"head"===o?void 0:o)]):(0,r.of)(null)),(0,T.x)((e,n)=>{if(!e||!n)return!e&&!n;const[o,c]=e,[l,y]=n;return o&&l?!(o.repositoryPath!==l.repositoryPath||o.isUnstaged!==l.isUnstaged||o.patch.newFileId!==l.patch.newFileId||o.patch.newFileIsDir!==l.patch.newFileIsDir||o.patch.newFileIsSubmodule!==l.patch.newFileIsSubmodule||o.patch.newFilePath!==l.patch.newFilePath||o.patch.oldFileId!==l.patch.oldFileId||o.patch.oldFileIsDir!==l.patch.oldFileIsDir||o.patch.oldFileIsSubmodule!==l.patch.oldFileIsSubmodule||o.patch.oldFilePath!==l.patch.oldFilePath||o.patch.status!==l.patch.status||o.patch.hunks.length!==l.patch.hunks.length||(0,U.Z)(o.patch.hunks,l.patch.hunks).some(([a,m])=>a?.lines.length!==m?.lines.length||a?.newStart!==m?.newStart||a?.oldStart!==m?.oldStart||a?.header!==m?.header||a&&m&&(0,U.Z)(a.lines,m.lines).some(([P,g])=>P?.content.length!==g?.content.length||P?.newLineNo!==g?.newLineNo||P?.oldLineNo!==g?.oldLineNo||P?.origin!==g?.origin||P?.content!==g?.content))||(0,U.Z)(c.hunks,y.hunks).some(([a,m])=>a?.startLineNo!==m?.startLineNo||a?.endLineNo!==m?.endLineNo||a?.authorName!==m?.authorName||a?.authorEmail!==m?.authorEmail||a?.commitId!==m?.commitId||a?.commitMessage!==m?.commitMessage||a?.commitDate!==m?.commitDate||a?.path!==m?.path)):!o&&!l}),(0,b.w)(e=>e&&e[0]?(0,J.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!1)).pipe((0,Z.K)(n=>d.OZ.matches(n)||d.hK.matches(n)?(0,r.of)(null):(0,O._)(()=>n)),(0,C.U)(n=>n?[e[0],e[1],n]:null)):(0,r.of)(null)),(0,R.b)(e=>{if(e&&e[0]){const[n,o,c]=e;this.blame.next(o),this.diffLines.next({hunks:n.patch.hunks,oldLines:c[0],newLines:c[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,b.w)(e=>e&&e[0]?(0,J.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!0)).pipe((0,Z.K)(n=>d.OZ.matches(n)||d.hK.matches(n)?(0,r.of)(null):(0,O._)(()=>n)),(0,C.U)(n=>n?[e[0],n]:null)):(0,r.of)(null)),(0,f.R)(this.destroyed$)).subscribe(e=>{if(e&&e[0]){const[n,o]=e;this.diffLines.next({hunks:n.patch.hunks,oldLines:o[0],newLines:o[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,j.a)([this.store.select(w.E.selectedRepository),this.route.queryParamMap.pipe((0,C.U)(e=>e.get("path")),(0,T.x)())]).pipe((0,b.w)(([e,n])=>e&&n?this.repositoriesApi.blameFile(e.path,n):(0,r.of)(null)),(0,Z.K)(()=>(0,r.of)(null)),(0,f.R)(this.destroyed$)).subscribe(e=>{e&&this.headBlame.next(e)})}getLines(e,n,o,c){if(n.oldFileIsSubmodule||n.newFileIsSubmodule){const l=n.hunks[0]?.lines.find(a=>a.oldLineNo>0),y=n.hunks[0]?.lines.find(a=>a.newLineNo>0);return[(0,r.of)([{lineNumber:1,text:l?.content??"",tokens:[{startIndex:0,endIndex:l?.content.length??0,scopes:["normal"]}]}]),(0,r.of)([{lineNumber:1,text:y?.content??"",tokens:[{startIndex:0,endIndex:y?.content.length??0,scopes:["normal"]}]}])]}return[n.oldFileId?this.highlightApi.getHighlightedFile(e,n.oldFileId,n.oldFilePath,c):(0,r.of)([]),o?this.highlightApi.getHighlightedFile(e,null,n.newFilePath,c):n.newFileId?this.highlightApi.getHighlightedFile(e,n.newFileId,n.newFilePath,c):(0,r.of)([])]}static{this.\u0275fac=function(n){return new(n||s)(t.Y36(L.gz),t.Y36(L.F0),t.Y36(N.yh),t.Y36(k.T),t.Y36(tt.m),t.Y36(et.a))}}static{this.\u0275cmp=t.Xpm({type:s,selectors:[["ng-component"]],features:[t.qOj],decls:23,vars:20,consts:[[3,"searched"],[3,"path"],["type","button","mat-icon-button","",1,"jump-to-commit-button","app-icon-button-md",3,"matTooltip","click"],[1,"commit-selector"],["panelClass","commit-select-list",3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["type","button","mat-icon-button","",1,"close-button","app-icon-button-md",3,"click"],[3,"repository","blame","diffLines","search","commitChanged"],[3,"matTooltip","remotes","email"],[1,"message"],[3,"value"],[1,"commit-select-option"],[1,"message",3,"matTooltip"],[1,"date"]],template:function(n,o){1&n&&(t.TgZ(0,"header")(1,"app-find-control",0),t.NdJ("searched",function(l){return o.search$.next(l)}),t.qZA(),t._UZ(2,"app-condensed-path",1),t.ALo(3,"async"),t.TgZ(4,"button",2),t.NdJ("click",function(){return o.jumpToSelectedCommit()}),t.ALo(5,"translate"),t.TgZ(6,"mat-icon"),t._uU(7,"launch"),t.qZA()(),t.TgZ(8,"mat-form-field",3)(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"mat-select",4)(13,"mat-select-trigger"),t.YNc(14,xt,5,6,"span",5),t.ALo(15,"async"),t.qZA(),t.YNc(16,vt,9,12,"mat-option",6),t.ALo(17,"async"),t.qZA()(),t.TgZ(18,"button",7),t.NdJ("click",function(){return o.close()}),t.TgZ(19,"mat-icon"),t._uU(20,"close"),t.qZA()()(),t.TgZ(21,"main")(22,"app-blame-view",8),t.NdJ("commitChanged",function(l){return o.selectedCommitControl.setValue(l)}),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("path",t.lcZ(3,10,o.selectedPath)),t.xp6(2),t.Q6J("matTooltip",t.lcZ(5,12,"Jump to the selected commit")),t.xp6(6),t.Oqu(t.lcZ(11,14,"Select Commit")),t.xp6(2),t.Q6J("formControl",o.selectedCommitControl),t.xp6(2),t.Q6J("ngIf",t.lcZ(15,16,o.selectedCommit)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(17,18,o.commits)),t.xp6(6),t.Q6J("repository",o.selectedRepository)("blame",o.blame)("diffLines",o.diffLines)("search",o.search$))},dependencies:[X.KE,X.hX,_.gD,_.$L,nt.ey,x.sg,x.O5,A.JJ,A.oH,ot.RK,Y.Hw,E.gM,K.A,it.j,st.T,Ot,x.Ov,z.v,G.X],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding-top:10px}header[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:baseline;justify-content:space-between;margin-bottom:5px;outline:none;padding:0 10px}header[_ngcontent-%COMP%]   app-condensed-path[_ngcontent-%COMP%]{flex:1 1 auto;min-width:200px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]{width:500px;margin-right:12px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]   mat-select-trigger[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{height:19px;vertical-align:middle;margin-right:5px}header[_ngcontent-%COMP%]   .jump-to-commit-button[_ngcontent-%COMP%], header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{top:-8px}main[_ngcontent-%COMP%]{flex:1 0 auto;outline:none;overflow-x:auto;overflow-y:auto}"],data:{animation:[(0,h.X$)("slideLeft",[(0,h.eR)(":enter",[(0,h.oB)({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),(0,h.jt)("200ms",(0,h.oB)({transform:"translateX(0)"}))]),(0,h.eR)(":leave",[(0,h.oB)({position:"absolute",top:0,left:0,transform:"translateX(0)"}),(0,h.jt)("200ms",(0,h.oB)({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return(0,q.gn)([(0,N.Ph)(w.E.selectedRepository)],s.prototype,"selectedRepository",void 0),s})()}];let Lt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[L.Bz.forChild(yt),L.Bz]})}}return s})(),Zt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[_.LD,S.I,W,Lt]})}}return s})()}}]);