import{b as Ae}from"./chunk-CHX4YGTE.js";import{D as N,b as He,c as ze,e as M}from"./chunk-XFRRWCWM.js";import{$ as F,$i as Q,Aa as T,Ai as Ee,Bi as De,G as w,Ga as ie,Hb as me,Ia as x,Ib as _e,Ii as $e,Ka as ne,La as g,Li as A,Mb as L,Na as R,Oe as ue,Ri as Le,Se as fe,Si as je,T as J,Te as he,Ti as Ge,Ua as r,Ue as ke,Va as a,Wa as re,We as Ce,Wh as Pe,Xa as ae,Xe as xe,Ya as se,Yh as H,Zf as j,_a as y,_e as ye,a as P,ab as h,af as we,b as O,bb as s,bf as Me,da as E,ea as D,gb as pe,ge as I,gi as Oe,hb as le,he as X,hh as ve,ia as d,ib as ce,ie as ge,ig as G,ih as be,ja as m,jb as K,kb as c,lb as k,lh as Y,mb as de,mg as S,n as B,ni as Be,oi as Ve,pa as V,q as te,ri as Te,s as oe,sb as W,si as Re,ti as Ie,ub as u,ui as Se,v as U,vb as f,vi as Ne,wi as Fe,yb as $,yi as z,za as p}from"./chunk-LQ6WPIKI.js";var et=["dialogTemplate"],tt=i=>["app/repository",i],ot=i=>[i];function it(i,C){if(i&1&&(r(0,"mat-icon"),c(1),a()),i&2){let e=s().$implicit;p(),k(e.expanded?"expand_more":"chevron_right")}}function nt(i,C){if(i&1){let e=y();r(0,"div",12)(1,"button",13),h("click",function(){d(e);let t=s().$implicit,n=s(2);return m(n.addFolder(t.id))}),r(2,"mat-icon"),c(3,"create_new_folder"),a(),r(4,"span"),c(5),u(6,"translate"),a()(),r(7,"button",13),h("click",function(){d(e);let t=s().$implicit,n=s(2);return m(n.renameFolder(t))}),r(8,"mat-icon"),c(9,"edit"),a(),r(10,"span"),c(11),u(12,"translate"),a()(),r(13,"button",13),h("click",function(){d(e);let t=s().$implicit,n=s(2);return m(n.deleteNode(t))}),r(14,"mat-icon"),c(15,"delete"),a(),r(16,"span"),c(17),u(18,"translate"),a()()()}i&2&&(p(5),k(f(6,3,"New !bookmark! folder")),p(6),k(f(12,5,"Rename")),p(6),k(f(18,7,"Delete")))}function rt(i,C){if(i&1){let e=y();r(0,"div",9,1),h("click",function(){let t=d(e).$implicit,n=s(2);return m(n.nodeClick.next(t))}),r(2,"span")(3,"mat-icon",10),c(4,"folder"),a(),c(5),a(),r(6,"button",11),x(7,it,2,1,"mat-icon",3),a(),x(8,nt,19,9,"ng-template",null,2,$),a()}if(i&2){let e=C.$implicit,o=K(9),t=s(2);R("selected",t.selectedNodeId===e.id),g("appContextMenu",o),p(5),de(" ",e.name," "),p(2),g("ngIf",e.children.length>0)}}function at(i,C){if(i&1){let e=y();r(0,"div",12)(1,"button",13),h("click",function(){d(e);let t=s().$implicit,n=s(2);return m(n.deleteNode(t))}),r(2,"mat-icon"),c(3,"delete"),a(),r(4,"span"),c(5),u(6,"translate"),a()()()}i&2&&(p(5),k(f(6,1,"Delete")))}function st(i,C){if(i&1){let e=y();r(0,"div",14,1),h("click",function(){let t=d(e).$implicit,n=s(2);return m(n.nodeClick.next(t))}),r(2,"span"),c(3),a(),x(4,at,7,3,"ng-template",null,2,$),a()}if(i&2){let e=C.$implicit,o=K(5),t=s(2);R("selected",t.selectedNodeId===e.id),g("appContextMenu",o)("matTooltip",e.id),p(3),k(e.name)}}function pt(i,C){if(i&1){let e=y();r(0,"div",15),h("dragover",function(t){d(e);let n=s(2);return m(n.dragoverListener(t))})("drop",function(t){d(e);let n=s(2);return m(n.dropListener(t))}),a()}}function lt(i,C){if(i&1){let e=y();ae(0),r(1,"app-tree",5),h("treeChange",function(t){d(e);let n=s();return m(n.treeChanged(t))}),x(2,rt,10,5,"div",6)(3,st,6,5,"div",7),a(),x(4,pt,1,0,"div",8),se()}if(i&2){let e=C.ngIf,o=s();p(),g("tree",e)("dragListeners",W(5,ot,W(3,tt,o.addNode))),p(3),g("ngIf",e.length===0)}}function ct(i,C){if(i&1&&(r(0,"div",16),c(1),a(),r(2,"form",17)(3,"mat-dialog-content")(4,"mat-form-field",18)(5,"mat-label"),c(6),u(7,"translate"),a(),re(8,"input",19),a()(),r(9,"mat-dialog-actions")(10,"button",20),c(11),u(12,"translate"),a(),r(13,"button",21),c(14),u(15,"translate"),a()()()),i&2){let e=s();p(),k(e.dialogTitle),p(),g("formGroup",e.dialogForm),p(4),k(f(7,8,"Name")),p(4),g("mat-dialog-close",null),p(),k(f(12,10,"Cancel")),p(2),g("mat-dialog-close",e.dialogForm.controls.name.value)("disabled",e.dialogForm.invalid),p(),k(f(15,12,"Save"))}}var Qe=i=>!!i.children,Ft=(()=>{class i extends ve(be){constructor(e,o){super(),this.dialog=e,this.store=o,this.selectedNodeId=null,this.nodeClick=new V,this.tree=this.repositoryBookmarks.pipe(oe(t=>t.map(n=>this.convertBookmarkToNode(n,"")))),this.dialogTitle="New Folder",this.dialogForm=new ke({name:new Ce(null)}),this.dialogRef=null,this.addNode=(t,n,l,_)=>{U([this.repositoryNames.pipe(w(1)),this.repositoryBookmarks.pipe(w(1))]).subscribe(([v,qe])=>{let q={name:v[t]??"",repositoryId:t},Ue=b=>{if(l==="above")return[q,b];if(l==="below")return[b,q];if(_||!this.isBookmarkFolder(b))throw new X;return[O(P({},b),{expanded:!0,children:[...b.children,q]})]},ee=this.replaceBookmark(qe,n,"",Ue);if(!ee)throw new I(n);this.store.dispatch(new M(ee))})},this.dragoverListener=t=>{t.dataTransfer?.types.includes("app/repository")&&(t.preventDefault(),t.dataTransfer.dropEffect="move")},this.dropListener=t=>{if(t.dataTransfer?.types.includes("app/repository")){t.preventDefault();let n=t.dataTransfer.getData("app/repository");U([this.repositoryNames.pipe(w(1)),this.repositoryBookmarks.pipe(w(1))]).subscribe(([l,_])=>{let v={name:l[n]??"",repositoryId:n};this.store.dispatch(new M([v]))})}},this.convertBookmarkToNode=(t,n)=>this.isBookmarkFolder(t)?{id:`folder:${this.getPath(t,n)}`,name:t.name,children:t.children.map(l=>this.convertBookmarkToNode(l,this.getPath(t,n))),expanded:t.expanded}:{id:t.repositoryId,name:t.name},this.convertNodeToBookmark=t=>Qe(t)?{name:t.name,expanded:t.expanded??!1,children:t.children.map(this.convertNodeToBookmark)}:{name:t.name,repositoryId:t.id}}ngOnDestroy(){super.ngOnDestroy(),this.dialogRef&&this.dialogRef.close()}treeChanged(e){this.store.dispatch(new M(e.map(this.convertNodeToBookmark)))}toggleMenu(e,o){e.stopPropagation();let t=e.currentTarget.getBoundingClientRect();o.toggleMenu(t.x,t.y+t.height)}addFolder(e){this.dialogRef&&this.dialogRef.close(),this.dialogTitle=Y("New !bookmark! Folder"),this.dialogForm.reset(),this.dialogRef=this.dialog.open(this.dialogTemplate),this.dialogRef.afterClosed().pipe(J(this.destroyed$)).subscribe(o=>{o&&this.repositoryBookmarks.pipe(w(1)).subscribe(t=>{let n={name:o,children:[],expanded:!1},l=e?this.replaceBookmark(t,e,"",_=>{if(!this.isBookmarkFolder(_))throw new X;return[O(P({},_),{children:[..._.children,n]})]}):[...t,n];if(!l)throw new I(e??"");this.store.dispatch(new M(l))})})}deleteNode(e){this.repositoryBookmarks.pipe(w(1)).subscribe(o=>{let t=this.replaceBookmark(o,e.id,"",()=>[]);if(!t)throw new I(e.id);this.store.dispatch(new M(t))})}renameFolder(e){if(!Qe(e))throw new ge(e.id);this.dialogTitle=Y("Rename !bookmark! Folder"),this.dialogForm.reset({name:e.name}),this.dialog.open(this.dialogTemplate).afterClosed().pipe(J(this.destroyed$)).subscribe(o=>{o&&this.repositoryBookmarks.pipe(w(1)).subscribe(t=>{let n=this.replaceBookmark(t,e.id,"",l=>[O(P({},l),{name:o})]);if(!n)throw new I(e.id);this.store.dispatch(new M(n))})})}isBookmarkFolder(e){return!!e.children}replaceBookmark(e,o,t,n){for(let l=0;l<e.length;l++){let _=e[l];if(o===(this.isBookmarkFolder(_)?`folder:${this.getPath(_,t)}`:_.repositoryId))return[...e.slice(0,l),...n(_),...e.slice(l+1)];if(this.isBookmarkFolder(_)){let v=this.replaceBookmark(_.children,o,this.getPath(_,t),n);if(v)return[...e.slice(0,l),O(P({},_),{children:v}),...e.slice(l+1)]}}return null}getPath(e,o){return o?`${o}///${e.name.replace("/","//")}`:e.name.replace("/","//")}static{this.\u0275fac=function(o){return new(o||i)(T(Te),T(G))}}static{this.\u0275cmp=E({type:i,selectors:[["app-repository-bookmarks-view"]],viewQuery:function(o,t){if(o&1&&pe(et,5),o&2){let n;le(n=ce())&&(t.dialogTemplate=n.first)}},inputs:{selectedNodeId:"selectedNodeId"},outputs:{nodeClick:"nodeClick"},features:[ie],decls:8,vars:6,consts:[["dialogTemplate",""],["contextMenu","appContextMenu"],["menu",""],[4,"ngIf"],["type","button","mat-stroked-button","",1,"add-folder-button",3,"click","matTooltip"],[3,"treeChange","tree","dragListeners"],["class","bookmark-node",3,"appContextMenu","selected","click",4,"appTreeNode"],["class","bookmark-node",3,"appContextMenu","selected","matTooltip","click",4,"appTreeLeafNode"],["class","first-drag-zone","draggable","true",3,"dragover","drop",4,"ngIf"],[1,"bookmark-node",3,"click","appContextMenu"],[1,"folder-icon"],["type","button","mat-icon-button","",1,"expand-button","app-icon-button-md"],[1,"menu-panel"],[1,"menu-item",3,"click"],[1,"bookmark-node",3,"click","appContextMenu","matTooltip"],["draggable","true",1,"first-drag-zone",3,"dragover","drop"],["mat-dialog-title",""],[3,"formGroup"],["subscriptSizing","dynamic",1,"full-width"],["type","text","matInput","","required","","formControlName","name"],["mat-button","",3,"mat-dialog-close"],["mat-flat-button","","type","submit","color","primary",3,"mat-dialog-close","disabled"]],template:function(o,t){if(o&1){let n=y();x(0,lt,5,7,"ng-container",3),u(1,"async"),r(2,"button",4),u(3,"translate"),h("click",function(){return d(n),m(t.addFolder())}),r(4,"mat-icon"),c(5,"create_new_folder"),a()(),x(6,ct,16,14,"ng-template",null,0,$)}o&2&&(g("ngIf",f(1,2,t.tree)),p(2),g("matTooltip",f(3,4,"Add !bookmark! folder")))},dependencies:[Re,Ie,Ne,Se,Be,Oe,Ee,_e,xe,ue,fe,he,Me,ye,we,Pe,H,z,j,$e,Ge,je,Le,L,A],styles:["app-tree[_ngcontent-%COMP%]{display:block;margin-left:-8px}app-tree[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{vertical-align:middle}app-tree[_ngcontent-%COMP%]   .bookmark-node[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding-left:10px}app-tree[_ngcontent-%COMP%]   .bookmark-node[_ngcontent-%COMP%]   .folder-icon[_ngcontent-%COMP%]{margin-right:5px}app-tree[_ngcontent-%COMP%]     app-tree-leaf-node .bookmark-node{padding-top:5px;padding-bottom:5px}.first-drag-zone[_ngcontent-%COMP%]{height:50px}.full-width[_ngcontent-%COMP%]{width:100%}.add-folder-button[_ngcontent-%COMP%]{margin-top:10px}.dark-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-above), .dark-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-above){border-top-color:#78909c}.dark-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-below), .dark-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-below){border-bottom-color:#78909c}.dark-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]   .bookmark-node.selected[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]   .bookmark-node.selected[_ngcontent-%COMP%]{background:#78909c}.light-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-above), .light-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-above){border-top-color:#cfd8dc}.light-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-below), .light-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]     app-tree-leaf-node:has(>.bookmark-node.selected):not(.drag-below){border-bottom-color:#cfd8dc}.light-theme[_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]   .bookmark-node.selected[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   app-tree[_ngcontent-%COMP%]   .bookmark-node.selected[_ngcontent-%COMP%]{background:#cfd8dc}"],changeDetection:0})}}return B([S(N.repositoryBookmarks)],i.prototype,"repositoryBookmarks",void 0),B([S(N.repositoryNames)],i.prototype,"repositoryNames",void 0),i})();var zt=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=D({type:i})}static{this.\u0275inj=F({imports:[Fe,Ve,De,Ae,Q]})}}return i})();function dt(i,C){if(i&1){let e=y();r(0,"li",1),u(1,"async"),h("click",function(){let t=d(e).$implicit,n=s();return m(n.clicked.next(t.repositoryId))})("dblclick",function(){let t=d(e).$implicit,n=s();return m(n.openRepository(t.repositoryId))})("dragstart",function(t){let n=d(e).$implicit,l=s();return m(l.dragStarted.next([t,n.repositoryId]))}),r(2,"span",2),c(3),a(),r(4,"button",3),u(5,"translate"),h("click",function(t){let n=d(e).$implicit;return s().deleteRepository(n.repositoryId),t.preventDefault(),m(t.stopPropagation())}),r(6,"mat-icon",4),c(7,"close"),a()()()}if(i&2){let e=C.$implicit,o=s();R("selected",e.repositoryId===f(1,6,o.selectedId)),ne("draggable",o.draggable?"true":"false"),p(2),g("matTooltip",e.repositoryId),p(),k(e.name),p(),g("matTooltip",f(5,8,"Remove repository (all settings saved in Glint will be removed)"))}}var to=(()=>{class i{constructor(e){this.store=e,this.draggable=!0,this.selectedId=te(null),this.clicked=new V,this.dragStarted=new V}openRepository(e){this.store.dispatch(new ze(e))}deleteRepository(e){this.store.dispatch(new He(e))}static{this.\u0275fac=function(o){return new(o||i)(T(G))}}static{this.\u0275cmp=E({type:i,selectors:[["app-repository-history-view"]],inputs:{draggable:"draggable",selectedId:"selectedId"},outputs:{clicked:"clicked",dragStarted:"dragStarted"},decls:3,vars:3,consts:[[3,"selected","click","dblclick","dragstart",4,"ngFor","ngForOf"],[3,"click","dblclick","dragstart"],[1,"name",3,"matTooltip"],["mat-icon-button","","color","warn",1,"close-icon",3,"click","matTooltip"],["inline",""]],template:function(o,t){o&1&&(r(0,"ul"),x(1,dt,8,10,"li",0),u(2,"async"),a()),o&2&&(p(),g("ngForOf",f(2,1,t.recentRepositories)))},dependencies:[me,H,z,j,L,A],styles:["ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{padding:10px;cursor:pointer;display:flex;justify-content:space-between}ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding-right:5px}ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .close-icon[_ngcontent-%COMP%]{flex:0 0 20px;width:20px;height:20px;padding:0;font-size:18px;opacity:0;transition:opacity .1s ease-in-out}ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .close-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{line-height:20px}ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover   .close-icon[_ngcontent-%COMP%]{opacity:1}.dark-theme[_nghost-%COMP%]   ul[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   ul[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%]{background:#78909c}.light-theme[_nghost-%COMP%]   ul[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   ul[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%]{background:#cfd8dc}"],changeDetection:0})}}return B([S(N.recentRepositories)],i.prototype,"recentRepositories",void 0),i})();var no=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=D({type:i})}static{this.\u0275inj=F({imports:[Q]})}}return i})();export{Qe as a,Ft as b,zt as c,to as d,no as e};
