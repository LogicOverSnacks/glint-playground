"use strict";(self.webpackChunkgit_glint=self.webpackChunkgit_glint||[]).push([[623],{4623:(At,R,i)=>{i.r(R),i.d(R,{BlameLayoutModule:()=>It});var N=i(8525),$=i(1345),j=i(5940),W=i(8700),t=i(9212);let q=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[j.Cq,$.I,W.m]})}}return s})();var L=i(3897),k=i(7582),C=i(6825),S=i(6223),U=i(5932),J=i(9738),M=i(5619),d=i(2096),x=i(8504),B=i(2572),_=i(9315),f=i(7398),Z=i(6306),h=i(9773),w=i(3997),V=i(9397),F=i(4664),u=i(3153),X=i(4573),D=i(7910),Q=i(751),I=i(4214),b=i(2401),tt=i(2718),et=i(7735),nt=i(7361),ot=i(4522),Y=i(4170),it=i(3680),v=i(6814),st=i(2296),E=i(617),K=i(2596),z=i(1102),lt=i(4551),at=i(680),A=i(7368),ct=i(7547),mt=i(8180),rt=i(1361),dt=i(4794),gt=i(2368),pt=i(7337),ht=i(6275),ut=i(2598),Ct=i(6885),H=i(2415),G=i(7484),ft=i(6974);const Mt=["scrollContainer"];function Pt(s,g){1&s&&(t.TgZ(0,"div",7),t._UZ(1,"mat-spinner"),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&s&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"Loading..."),"\n"))}function Ot(s,g){if(1&s&&(t.TgZ(0,"span",13)(1,"span",14),t._uU(2),t.qZA(),t._UZ(3,"app-avatar",15),t.ALo(4,"async"),t.TgZ(5,"span",16),t._uU(6),t.qZA(),t.TgZ(7,"span",17),t._uU(8),t.ALo(9,"translateDate"),t.qZA()()),2&s){const e=g.ngIf,n=t.oxw(2),o=t.MAs(11);t.Udp("left",-n.lineNumberMargin-26-400,"px"),t.Q6J("appContextMenu",o)("appContextMenuData",e),t.xp6(),t.Q6J("matTooltip",e.commitId),t.xp6(),t.Oqu(e.commitId),t.xp6(),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(4,12,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(9,14,e.date,"mediumDate"))}}function xt(s,g){if(1&s&&(t.TgZ(0,"span",19),t._uU(1),t.qZA()),2&s){const e=g.$implicit;t.Q6J("ngClass",e.class),t.xp6(),t.Oqu(e.text)}}function vt(s,g){if(1&s&&(t.ynx(0),t.YNc(1,xt,2,2,"span",18),t.ALo(2,"tokens"),t.ALo(3,"findToken"),t.BQk()),2&s){const e=g.ngIf,n=t.oxw().index;t.xp6(),t.Q6J("ngForOf",t.xi3(2,1,t.Dn7(3,4,e.tokens,e.text,n),e.text))}}function yt(s,g){if(1&s&&(t.TgZ(0,"li",8),t.YNc(1,Ot,10,17,"span",9),t.ALo(2,"async"),t.TgZ(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"span",11),t._uU(6),t.qZA(),t.YNc(7,vt,4,8,"ng-container",12),t.qZA()),2&s){const e=g.$implicit,n=t.oxw();let o;t.Q6J("ngClass","line-"+e.status),t.xp6(),t.Q6J("ngIf",null==(o=t.lcZ(2,11,n.blameLines$))?null:o[null==e.newLine?null:e.newLine.lineNumber]),t.xp6(2),t.Udp("right","calc(100% + 26px + "+(n.lineNumberMargin/2).toString()+"px)")("width",n.lineNumberMargin/2-5,"px"),t.xp6(),t.Oqu(null==e.oldLine?null:e.oldLine.lineNumber),t.xp6(),t.Udp("width",n.lineNumberMargin/2-5,"px"),t.xp6(),t.Oqu(null==e.newLine?null:e.newLine.lineNumber),t.xp6(),t.Q6J("ngIf",n.getLineView(e))}}function Lt(s,g){if(1&s){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){const l=t.CHM(e).data,a=t.oxw();return t.KtG(a.copyToClipboard(l.commitId))}),t.TgZ(2,"mat-icon"),t._uU(3,"content_copy"),t.qZA(),t.TgZ(4,"span"),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"button",21),t.NdJ("click",function(){const l=t.CHM(e).data,a=t.oxw();return t.KtG(a.selectCommit(l.commitId))}),t.TgZ(8,"mat-icon"),t._uU(9,"document_scanner"),t.qZA(),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"button",21),t.NdJ("click",function(){const l=t.CHM(e).data,a=t.oxw();return t.KtG(a.jumpToCommit(l.commitId))}),t.TgZ(14,"mat-icon"),t._uU(15,"launch"),t.qZA(),t.TgZ(16,"span"),t._uU(17),t.ALo(18,"translate"),t.qZA()()()}if(2&s){const e=g.data;t.xp6(),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(6,6,"Copy Commit ID")),t.xp6(2),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(12,8,"Blame from this Commit")),t.xp6(2),t.Q6J("matTooltip",e.commitId),t.xp6(4),t.Oqu(t.lcZ(18,10,"Jump to Commit"))}}let Zt=(()=>{class s extends((0,X.j)(D.A,rt.P)){constructor(e,n,o,l,a){super(),this.router=e,this.store=n,this.diffService=o,this.diffSelectionService=l,this.findSelectionService=a,this.commitChanged=new t.vpe,this.lineNumberMargin=0,this.lines$=new M.X([]),this.blameLines$=new M.X({})}ngOnInit(){const e=this.scrollContainer.nativeElement;this.remotes=this.repository.pipe((0,f.U)(n=>n?.remotes??[])),this.blame.pipe((0,h.R)(this.destroyed$)).subscribe(n=>{if(n){const o=n.hunks.map(l=>[l.startLineNo,{name:l.authorName,email:l.authorEmail,commitId:l.commitId,message:l.commitMessage,date:l.commitDate}]);this.blameLines$.next(Object.fromEntries(o))}else this.blameLines$.next({})}),this.diffLines.pipe((0,ct.g)(0),(0,h.R)(this.destroyed$)).subscribe(n=>{if(n){const o=Math.max(n.oldLines.length,n.newLines.length)??0;this.lineNumberMargin=this.diffService.calculateMargin(o.toString().length),this.diffService.calculateInlineLines(n.oldLines,n.newLines,n.hunks).pipe((0,h.R)(this.destroyed$)).subscribe(l=>{this.lines$.next(l)})}else this.lineNumberMargin=0,this.lines$.next([])}),(0,B.a)([this.lines$,this.findSelectionService.searchRegex]).pipe((0,h.R)(this.destroyed$)).subscribe(([n,o])=>{if(!o)return void this.findSelectionService.setMatches([]);const l=n.map((a,p)=>[this.getLineView(a),p]).flatMap(([a,p])=>a?Array.from(a.text.matchAll(o),m=>({lineId:p,startIndex:m.index??0,endIndex:(m.index??0)+(m[0]?.length??0)})):[]);this.findSelectionService.setMatches(l)}),this.findSelectionService.selectedMatch.pipe((0,h.R)(this.destroyed$)).subscribe(n=>{if(!n||"number"!=typeof n.lineId)return;const o=this.lineNumberMargin+26+400+10+n.startIndex*this.diffSelectionService.charWidth;e.scrollTo(o<e.scrollLeft?o:o>e.scrollLeft+e.clientWidth?this.lineNumberMargin+26+400+10+n.endIndex*this.diffSelectionService.charWidth-e.clientWidth:e.scrollLeft,19*n.lineId)})}getLineView(e){return"added"===e.status?e.newLine:"removed"===e.status?e.oldLine:"unchanged"===e.status?e.newLine??e.oldLine:null}trackByDiffLine(e,n){return e}copyToClipboard(e){navigator.clipboard.writeText(e??"")}selectCommit(e){this.commitChanged.next(e)}jumpToCommit(e){this.repository.pipe((0,mt.q)(1),(0,h.R)(this.destroyed$)).subscribe(n=>{if(!n)throw new u.Ys;this.store.dispatch([new I.jQ(n.path,e),new I.BK(n.path,e)]).subscribe(()=>{this.router.navigate(["/standard/default"])})})}static{this.\u0275fac=function(n){return new(n||s)(t.Y36(L.F0),t.Y36(U.yh),t.Y36(dt.S),t.Y36(gt.Q),t.Y36(pt.u))}}static{this.\u0275cmp=t.Xpm({type:s,selectors:[["app-blame-view"]],viewQuery:function(n,o){if(1&n&&(t.Gf(Mt,7,t.SBq),t.Gf(A.N7,5)),2&n){let l;t.iGM(l=t.CRH())&&(o.scrollContainer=l.first),t.iGM(l=t.CRH())&&(o.viewports=l)}},inputs:{repository:"repository",blame:"blame",diffLines:"diffLines"},outputs:{commitChanged:"commitChanged"},features:[t.qOj],decls:12,vars:14,consts:[["class","loading",4,"ngIf"],[1,"viewport",3,"itemSize","maxBufferPx","minBufferPx"],["scrollContainer",""],["tabindex","0",1,"vs-code-theme"],["code",""],["class","line",3,"ngClass",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],["contextMenu",""],[1,"loading"],[1,"line",3,"ngClass"],["class","blame",3,"left","appContextMenu","appContextMenuData",4,"ngIf"],[1,"old-line-number"],[1,"new-line-number"],[4,"ngIf"],[1,"blame",3,"appContextMenu","appContextMenuData"],[1,"commit-id",3,"matTooltip"],[3,"matTooltip","remotes","email"],[1,"message",3,"matTooltip"],[1,"date"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"menu-panel"],[1,"menu-item",3,"matTooltip","click"]],template:function(n,o){1&n&&(t.YNc(0,Pt,4,3,"div",0),t.ALo(1,"nullEmpty"),t.ALo(2,"async"),t.TgZ(3,"cdk-virtual-scroll-viewport",1,2)(5,"code",3,4)(7,"ul"),t.YNc(8,yt,8,13,"li",5),t.ALo(9,"async"),t.qZA()()(),t.YNc(10,Lt,19,12,"ng-template",null,6,t.W1O)),2&n&&(t.Q6J("ngIf",!t.lcZ(1,8,t.lcZ(2,10,o.lines$))),t.xp6(3),t.Q6J("itemSize",19)("maxBufferPx",1e3)("minBufferPx",200),t.xp6(4),t.Udp("margin-left",o.lineNumberMargin+26+400+10,"px"),t.xp6(),t.Q6J("cdkVirtualForOf",t.lcZ(9,12,o.lines$))("cdkVirtualForTrackBy",o.trackByDiffLine))},dependencies:[j.Ou,A.xd,A.x0,A.N7,v.mk,v.sg,v.O5,E.Hw,K.gM,z.A,ht.l,v.Ov,ut.l,Ct.x,H.v,G.X,ft.U],styles:[".loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:10px;margin:20px;width:100px}code[_ngcontent-%COMP%]{display:block;white-space:pre}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]{position:absolute;width:400px;overflow:hidden;user-select:none;font-size:0;display:flex;justify-content:space-between;align-items:center;gap:5px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{width:16px;height:16px;flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:1rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .commit-id[_ngcontent-%COMP%]{flex:0 0 50px}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{flex:1 1 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{flex:0 0 auto}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{position:absolute;text-align:right;user-select:none}code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{right:calc(100% + 26px)}.viewport[_ngcontent-%COMP%]{height:100%;width:100%}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#858585}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .blame[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{color:#90a4ae}.light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .old-line-number[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   code[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .new-line-number[_ngcontent-%COMP%]{color:#5e5e5e}"],changeDetection:0})}}return s})();function bt(s,g){if(1&s&&(t.TgZ(0,"span"),t._UZ(1,"app-avatar",8),t.ALo(2,"async"),t.TgZ(3,"span",9),t._uU(4),t.qZA()()),2&s){const e=g.ngIf,n=t.oxw();t.xp6(),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(2,4,n.remotes))("email",e.email),t.xp6(3),t.Oqu(e.message)}}function Tt(s,g){if(1&s&&(t.TgZ(0,"mat-option",10)(1,"div",11),t._UZ(2,"app-avatar",8),t.ALo(3,"async"),t.TgZ(4,"span",12),t._uU(5),t.qZA(),t.TgZ(6,"span",13),t._uU(7),t.ALo(8,"translateDate"),t.qZA()()()),2&s){const e=g.$implicit,n=t.oxw();t.Q6J("value",e.id),t.xp6(2),t.Q6J("matTooltip",e.name+" ("+e.email+")")("remotes",t.lcZ(3,7,n.remotes))("email",e.email),t.xp6(2),t.Q6J("matTooltip",e.message),t.xp6(),t.Oqu(e.message),t.xp6(2),t.Oqu(t.xi3(8,9,e.date,"mediumDate"))}}const wt=[{path:"",component:(()=>{class s extends((0,X.j)(D.A)){constructor(e,n,o,l,a,p,m){super(),this.route=e,this.router=n,this.store=o,this.commitsApi=l,this.highlightApi=a,this.repositoriesApi=p,this.routerHistoryService=m,this.blame=new M.X(null),this.headBlame=new M.X(null),this.commits=new M.X([]),this.diffLines=new M.X(null),this.selectedCommitControl=new S.NI(null),this.selectedCommit=new M.X(null),this.selectedPath=new M.X(null),this.jumpToSelectedCommit=()=>{const c=this.store.selectSnapshot(b.E.selectedRepositoryPath),r=this.selectedCommitControl.value;if(!c)throw new u.Ys;if(!r)throw new u.j8;this.store.dispatch([new I.jQ(c,r),new I.BK(c,r)]).subscribe(()=>{this.router.navigate(["/standard/default"])})},this.close=()=>{const c=this.routerHistoryService.history.findLast(r=>!r.startsWith("/standard/blame"))??"/standard/default";this.router.navigate([c])},this.getPatch=(c,r,P,T)=>"head"===P?("staged"===T?c.stagedChanges:"unstaged"===T?c.unstagedChanges:void 0)?.find(y=>y.newFilePath===r)?("staged"===T?this.repositoriesApi.getStagedPatch(c.path,void 0,r):this.repositoriesApi.getUnstagedPatch(c.path,void 0,r)).pipe((0,f.U)(y=>({repositoryPath:c.path,patch:y,isUnstaged:"unstaged"===T})),(0,Z.K)(y=>u.vE.matches(y)?(0,x._)(()=>new Q.ZR(y)):(0,x._)(()=>y))):(0,d.of)(null):"commit"!==T?(0,d.of)(null):this.commitsApi.getPatch(c.path,P,void 0,r).pipe((0,f.U)(O=>({repositoryPath:c.path,patch:O,isUnstaged:!1})),(0,Z.K)(O=>u.ik.matches(O)||u.vE.matches(O)?(0,x._)(()=>new Q.ZR(O)):(0,x._)(()=>O)))}ngOnInit(){this.remotes=this.selectedRepository.pipe((0,f.U)(e=>e?.remotes??[])),this.headBlame.pipe((0,f.U)(e=>{if(!e)return[];const n={};for(const o of e.hunks)n[o.commitId]||(n[o.commitId]={id:o.commitId,date:o.commitDate,email:o.authorEmail,name:o.authorName,message:o.commitMessage,path:o.path});return Object.values(n).sort((o,l)=>l.date.getTime()-o.date.getTime())}),(0,h.R)(this.destroyed$)).subscribe(e=>{this.commits.next(e);const n=this.selectedCommitControl.value;this.selectedCommit.next(e.find(o=>o.id===n)??null)}),this.selectedCommitControl.valueChanges.pipe((0,w.x)(),(0,h.R)(this.destroyed$)).subscribe(e=>{const n=this.commits.value.find(o=>o.id===e)??null;n&&(this.selectedCommit.next(n),this.router.navigate([],{relativeTo:this.route,queryParams:{area:"commit","commit-id":e??"head",path:n.path}}))}),this.store.select(b.E.selectedRepository).pipe((0,h.R)(this.destroyed$)).subscribe(e=>{e||this.router.navigate(["/standard/open-repository"])}),(0,B.a)([this.store.select(b.E.selectedRepository).pipe((0,w.x)((e,n)=>e?.path===n?.path)),this.route.queryParamMap]).pipe((0,f.U)(([e,n])=>({repository:e,area:n.get("area"),commitId:n.get("commit-id"),path:n.get("path")})),(0,V.b)(({commitId:e,path:n})=>{this.selectedCommitControl.setValue("head"===e?null:e,{emitEvent:!0}),this.selectedPath.next(n)}),(0,F.w)(({repository:e,path:n,commitId:o,area:l})=>e&&n&&o?(0,_.D)([this.getPatch(e,n,o,l),this.repositoriesApi.blameFile(e.path,n,"head"===o?void 0:o)]):(0,d.of)(null)),(0,w.x)((e,n)=>{if(!e||!n)return!e&&!n;const[o,l]=e,[a,p]=n;return o&&a?!(o.repositoryPath!==a.repositoryPath||o.isUnstaged!==a.isUnstaged||o.patch.newFileId!==a.patch.newFileId||o.patch.newFileIsDir!==a.patch.newFileIsDir||o.patch.newFileIsSubmodule!==a.patch.newFileIsSubmodule||o.patch.newFilePath!==a.patch.newFilePath||o.patch.oldFileId!==a.patch.oldFileId||o.patch.oldFileIsDir!==a.patch.oldFileIsDir||o.patch.oldFileIsSubmodule!==a.patch.oldFileIsSubmodule||o.patch.oldFilePath!==a.patch.oldFilePath||o.patch.status!==a.patch.status||o.patch.hunks.length!==a.patch.hunks.length||(0,J.Z)(o.patch.hunks,a.patch.hunks).some(([m,c])=>m?.lines.length!==c?.lines.length||m?.newStart!==c?.newStart||m?.oldStart!==c?.oldStart||m?.header!==c?.header||m&&c&&(0,J.Z)(m.lines,c.lines).some(([r,P])=>r?.content.length!==P?.content.length||r?.newLineNo!==P?.newLineNo||r?.oldLineNo!==P?.oldLineNo||r?.origin!==P?.origin||r?.content!==P?.content))||(0,J.Z)(l.hunks,p.hunks).some(([m,c])=>m?.startLineNo!==c?.startLineNo||m?.endLineNo!==c?.endLineNo||m?.authorName!==c?.authorName||m?.authorEmail!==c?.authorEmail||m?.commitId!==c?.commitId||m?.commitMessage!==c?.commitMessage||m?.commitDate!==c?.commitDate||m?.path!==c?.path)):!o&&!a}),(0,F.w)(e=>e&&e[0]?(0,_.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!1)).pipe((0,Z.K)(n=>u.OZ.matches(n)||u.hK.matches(n)?(0,d.of)(null):(0,x._)(()=>n)),(0,f.U)(n=>n?[e[0],e[1],n]:null)):(0,d.of)(null)),(0,V.b)(e=>{if(e&&e[0]){const[n,o,l]=e;this.blame.next(o),this.diffLines.next({hunks:n.patch.hunks,oldLines:l[0],newLines:l[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,F.w)(e=>e&&e[0]?(0,_.D)(this.getLines(e[0].repositoryPath,e[0].patch,e[0].isUnstaged,!0)).pipe((0,Z.K)(n=>u.OZ.matches(n)||u.hK.matches(n)?(0,d.of)(null):(0,x._)(()=>n)),(0,f.U)(n=>n?[e[0],n]:null)):(0,d.of)(null)),(0,h.R)(this.destroyed$)).subscribe(e=>{if(e&&e[0]){const[n,o]=e;this.diffLines.next({hunks:n.patch.hunks,oldLines:o[0],newLines:o[1],oldFilePath:n.patch.oldFilePath,newFilePath:n.patch.newFilePath,highlighted:!1})}else this.blame.next(null),this.diffLines.next(null)}),(0,B.a)([this.store.select(b.E.selectedRepository),this.route.queryParamMap.pipe((0,f.U)(e=>e.get("path")),(0,w.x)())]).pipe((0,F.w)(([e,n])=>e&&n?this.repositoriesApi.blameFile(e.path,n):(0,d.of)(null)),(0,Z.K)(()=>(0,d.of)(null)),(0,h.R)(this.destroyed$)).subscribe(e=>{e&&this.headBlame.next(e)})}getLines(e,n,o,l){if(n.oldFileIsSubmodule||n.newFileIsSubmodule){const a=n.hunks[0]?.lines.find(m=>m.oldLineNo>0),p=n.hunks[0]?.lines.find(m=>m.newLineNo>0);return[(0,d.of)([{lineNumber:1,text:a?.content??"",tokens:[{startIndex:0,endIndex:a?.content.length??0,scopes:["normal"]}]}]),(0,d.of)([{lineNumber:1,text:p?.content??"",tokens:[{startIndex:0,endIndex:p?.content.length??0,scopes:["normal"]}]}])]}return[n.oldFileId?this.highlightApi.getHighlightedFile(e,n.oldFileId,n.oldFilePath,l):(0,d.of)([]),o?this.highlightApi.getHighlightedFile(e,null,n.newFilePath,l):n.newFileId?this.highlightApi.getHighlightedFile(e,n.newFileId,n.newFilePath,l):(0,d.of)([])]}static{this.\u0275fac=function(n){return new(n||s)(t.Y36(L.gz),t.Y36(L.F0),t.Y36(U.yh),t.Y36(tt.T),t.Y36(et.m),t.Y36(nt.a),t.Y36(ot.X))}}static{this.\u0275cmp=t.Xpm({type:s,selectors:[["ng-component"]],features:[t.qOj],decls:23,vars:19,consts:[[3,"path"],["type","button","mat-icon-button","",1,"jump-to-commit-button","app-icon-button-md",3,"matTooltip","click"],[1,"commit-selector"],["panelClass","commit-select-list",3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["type","button","mat-icon-button","",1,"close-button","app-icon-button-md",3,"click"],[3,"repository","blame","diffLines","commitChanged"],[3,"matTooltip","remotes","email"],[1,"message"],[3,"value"],[1,"commit-select-option"],[1,"message",3,"matTooltip"],[1,"date"]],template:function(n,o){1&n&&(t.TgZ(0,"header"),t._UZ(1,"app-find-control")(2,"app-condensed-path",0),t.ALo(3,"async"),t.TgZ(4,"button",1),t.NdJ("click",function(){return o.jumpToSelectedCommit()}),t.ALo(5,"translate"),t.TgZ(6,"mat-icon"),t._uU(7,"launch"),t.qZA()(),t.TgZ(8,"mat-form-field",2)(9,"mat-label"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"mat-select",3)(13,"mat-select-trigger"),t.YNc(14,bt,5,6,"span",4),t.ALo(15,"async"),t.qZA(),t.YNc(16,Tt,9,12,"mat-option",5),t.ALo(17,"async"),t.qZA()(),t.TgZ(18,"button",6),t.NdJ("click",function(){return o.close()}),t.TgZ(19,"mat-icon"),t._uU(20,"close"),t.qZA()()(),t.TgZ(21,"main")(22,"app-blame-view",7),t.NdJ("commitChanged",function(a){return o.selectedCommitControl.setValue(a)}),t.qZA()()),2&n&&(t.xp6(2),t.Q6J("path",t.lcZ(3,9,o.selectedPath)),t.xp6(2),t.Q6J("matTooltip",t.lcZ(5,11,"Jump to the selected commit")),t.xp6(6),t.Oqu(t.lcZ(11,13,"Select Commit")),t.xp6(2),t.Q6J("formControl",o.selectedCommitControl),t.xp6(2),t.Q6J("ngIf",t.lcZ(15,15,o.selectedCommit)),t.xp6(2),t.Q6J("ngForOf",t.lcZ(17,17,o.commits)),t.xp6(6),t.Q6J("repository",o.selectedRepository)("blame",o.blame)("diffLines",o.diffLines))},dependencies:[Y.KE,Y.hX,N.gD,N.$L,it.ey,v.sg,v.O5,S.JJ,S.oH,st.RK,E.Hw,K.gM,z.A,lt.j,at.T,Zt,v.Ov,H.v,G.X],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding-top:10px}header[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:baseline;justify-content:space-between;margin-bottom:5px;outline:none;padding:0 10px}header[_ngcontent-%COMP%]   app-condensed-path[_ngcontent-%COMP%]{flex:1 1 auto;min-width:200px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]{width:500px;margin-right:12px}header[_ngcontent-%COMP%]   .commit-selector[_ngcontent-%COMP%]   mat-select-trigger[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{height:19px;vertical-align:middle;margin-right:5px}header[_ngcontent-%COMP%]   .jump-to-commit-button[_ngcontent-%COMP%], header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{top:-8px}main[_ngcontent-%COMP%]{flex:1 0 auto;outline:none;overflow-x:auto;overflow-y:auto}"],data:{animation:[(0,C.X$)("slideLeft",[(0,C.eR)(":enter",[(0,C.oB)({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),(0,C.jt)("200ms",(0,C.oB)({transform:"translateX(0)"}))]),(0,C.eR)(":leave",[(0,C.oB)({position:"absolute",top:0,left:0,transform:"translateX(0)"}),(0,C.jt)("200ms",(0,C.oB)({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return(0,k.gn)([(0,U.Ph)(b.E.selectedRepository)],s.prototype,"selectedRepository",void 0),s})()}];let Ft=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[L.Bz.forChild(wt),L.Bz]})}}return s})(),It=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=t.oAB({type:s})}static{this.\u0275inj=t.cJS({imports:[N.LD,$.I,q,Ft]})}}return s})()}}]);