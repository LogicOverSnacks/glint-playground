import{Mh as f,_ as u,a as l,b as n,ba as v,dh as m,kg as o,lg as S,lh as p,n as r,og as d,rg as b}from"./chunk-LQ6WPIKI.js";var D=(()=>{class e{static{this.type="[Updates] UpdateAvailable"}constructor(t){this.version=t}}return e})(),P=(()=>{class e{static{this.type="[Updates] UpdateDownloadProgress"}constructor(t){this.progress=t}}return e})(),_=(()=>{class e{static{this.type="[Updates] UpdateDownloaded"}constructor(t){this.version=t}}return e})(),E=(()=>{class e{static{this.type="[Updates] UpdateFailed"}constructor(t){this.error=t}}return e})(),R=(()=>{class e{static{this.type="[Updates] ResetState"}}return e})(),w={updateState:null,availableVersion:null,downloadProgress:null},L=(()=>{let e=class h{static updateState(t){return t.updateState}static availableVersion(t){return t.availableVersion}static downloadProgress(t){return t.downloadProgress}constructor(t){this.updatesApiService=t}updateAvailable(t,a){t.setState(s=>n(l({},s),{updateState:a.version?"available":null,availableVersion:a.version}))}updateDownloadProgress(t,a){t.setState(s=>n(l({},s),{updateState:"downloading",downloadProgress:a.progress}))}updateDownloaded(t,a){t.setState(s=>n(l({},s),{updateState:"done",availableVersion:a.version,downloadProgress:null})),t.dispatch(new f("info",p("Update to version _version_ has been downloaded, restart Glint to install.",{version:a.version})))}updateFailed(t,a){t.setState(c=>n(l({},c),{updateState:null,availableVersion:null,downloadProgress:null}));let s=a.error?.code;if(s==="ERR_UPDATER_CHANNEL_FILE_NOT_FOUND"||s==="ERR_UPDATER_INVALID_UPDATE_INFO"){this.updatesApiService.getUpdateChannel().subscribe(c=>{let A=p(c==="alpha"?"alpha":c==="beta"?"beta":"stable");t.dispatch(new f("warn",p("Error finding updates on channel: _channel_, switching to stable.",{channel:A}))),this.updatesApiService.setUpdateChannel("latest").subscribe()});return}t.dispatch(new f("warn",p("Update failed. _error_",{error:a.error})))}resetState(t,a){t.setState(b(w))}static{this.\u0275fac=function(a){return new(a||h)(v(m))}}static{this.\u0275prov=u({token:h,factory:h.\u0275fac})}};return r([o(D)],e.prototype,"updateAvailable",null),r([o(P)],e.prototype,"updateDownloadProgress",null),r([o(_)],e.prototype,"updateDownloaded",null),r([o(E)],e.prototype,"updateFailed",null),r([o(R)],e.prototype,"resetState",null),r([d()],e,"updateState",null),r([d()],e,"availableVersion",null),r([d()],e,"downloadProgress",null),e=r([S({name:"updates",defaults:w})],e),e})();var F=(()=>{class e{static{this.type="[Analytics] SetEnabled"}constructor(t){this.enabled=t}}return e})(),I=(()=>{class e{static{this.type="[Analytics] ResetState"}}return e})(),y={version:1,enabled:!0},z=(()=>{let e=class U{static enabled(t){return t.enabled}setEnabled(t,a){t.setState(s=>n(l({},s),{enabled:a.enabled}))}resetState(t,a){t.setState(b(y))}static{this.\u0275fac=function(a){return new(a||U)}}static{this.\u0275prov=u({token:U,factory:U.\u0275fac})}};return r([o(F)],e.prototype,"setEnabled",null),r([o(I)],e.prototype,"resetState",null),r([d()],e,"enabled",null),e=r([S({name:"analytics",defaults:y})],e),e})();export{D as a,P as b,_ as c,E as d,R as e,L as f,F as g,I as h,z as i};
