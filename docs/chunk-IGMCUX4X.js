import{a as ci,b as di,c as hi,d as _i,e as Pi}from"./chunk-WWF34I3B.js";import"./chunk-7JLJ6BPP.js";import{a as Mi,b as yi}from"./chunk-B3BLWGNP.js";import{a as ni,b as oi}from"./chunk-MAKCXWR2.js";import{c as gi,d as Ci,e as bi}from"./chunk-DLIDMTHY.js";import"./chunk-DAMMMNIE.js";import{a as ui,b as ht,c as ut,g as fi}from"./chunk-YEA32JHD.js";import{c as Xt}from"./chunk-TQ2GYO4P.js";import"./chunk-GBUWXOUI.js";import{b as ft,e as vi}from"./chunk-W4WVVNAR.js";import"./chunk-4QOLI63R.js";import{b as mi}from"./chunk-ODA3O2LV.js";import{b as si}from"./chunk-A3ANYOTN.js";import{a as mt,b as ri,c as ct}from"./chunk-KTIAHO2X.js";import{a as dt,b as li}from"./chunk-HHP4IUCA.js";import{D as E,j as ai,q as pi}from"./chunk-AHHMW4YH.js";import{$ as Pe,$i as ii,Aa as y,Ag as zt,B as It,Bi as Ve,Ci as Zt,D as L,Dc as We,Di as ei,Ec as Dt,Ei as at,G as Rt,Ga as N,Hb as Qe,Ia as C,Ib as J,Ih as Qt,Jh as Ie,Ji as ti,Kh as Re,L as $e,La as a,Lh as Be,Mb as z,Mf as it,Mi as ee,Na as Et,Nf as Oe,Ob as Ft,Oe as Ye,Pi as pt,Qe as ye,Qf as Y,Qg as Ht,Qi as lt,R as X,S as B,Se as we,Sf as Se,Sg as nt,T as A,U as Bt,Ua as r,Ue as jt,Ug as ue,Uh as ke,V as pe,Va as p,Wa as b,We as K,Xa as qe,Xh as ot,Ya as Ae,Yd as de,Zd as Je,Ze as xe,Zf as he,Zh as rt,_ as ze,_a as Ce,_h as Wt,a as oe,ab as V,aj as st,b as re,ba as ve,bb as w,bd as ce,bf as Ze,da as j,ea as be,eb as W,gb as He,ha as kt,hb as Ge,hh as H,hi as fe,ia as le,ib as Ue,ig as T,ih as G,ii as Jt,j as q,ja as se,jb as me,kb as h,kh as Gt,lb as M,le as Ke,mb as $,mg as Le,n as Te,nb as vt,oi as ge,pf as et,pi as Kt,q as P,qc as Xe,qe as Lt,r as ae,rb as Tt,rc as qt,s as x,sb as ie,sc as Me,t as Fe,tc as At,ub as l,uh as Ut,v as Ot,vb as c,vf as Nt,w as St,wb as ne,wc as bt,xa as Vt,xi as Yt,yb as De,yf as tt,za as o,zf as $t,zi as Z}from"./chunk-RKMHOEIU.js";function $i(t,u){if(t&1){let e=Ce();r(0,"li",10),l(1,"async"),V("click",function(){let i=le(e).$implicit,m=w();return se(m.selectedCommitDetail.next(i))}),b(2,"app-avatar",11),r(3,"span",12),h(4),p()()}if(t&2){let e,n=u.$implicit,i=w(),m=me(12);Et("selected",n.id===((e=c(1,9,i.selectedCommitDetail))==null?null:e.id)),a("appContextMenu",m)("appContextMenuData",n),o(2),a("matTooltip",n.authorName+" ("+n.authorEmail+")")("remotes",i.remotes)("email",n.authorEmail),o(),a("matTooltip",n.message),o(),$(" ",i.getCommitSummary(n)," ")}}function zi(t,u){if(t&1){let e=Ce();r(0,"app-diff-view",13),V("closed",function(){le(e);let i=w();return se(i.selectedPatch.next(null))}),p()}if(t&2){let e=w();a("@slideLeft",void 0)("patch",e.selectedPatch)}}function Hi(t,u){if(t&1){let e=Ce();r(0,"app-commit-detail-view",14),V("patchChanged",function(i){le(e);let m=w();return se(m.patchChanged(i))}),p()}if(t&2){let e=w();a("commit",e.selectedCommitDetail)("selectedFile",e.selectedFile)}}function Gi(t,u){if(t&1){let e=Ce();r(0,"div",15)(1,"div",16),h(2),p(),r(3,"button",17),V("click",function(){let i=le(e).data,m=w();return se(m.copyToClipboard(i.commitId))}),r(4,"mat-icon"),h(5,"content_copy"),p(),r(6,"span"),h(7),l(8,"translate"),p()(),r(9,"button",17),V("click",function(){let i=le(e).data,m=w();return se(m.jumpToCommit(i.commitId))}),r(10,"mat-icon"),h(11,"launch"),p(),r(12,"span"),h(13),l(14,"translate"),p()()()}if(t&2){let e=u.data,n=w();o(),a("matTooltip",e.message),o(),M(n.getCommitSummary(e)),o(),a("matTooltip",e.commitId),o(4),M(c(8,6,"Copy Commit ID")),o(2),a("matTooltip",e.commitId),o(4),M(c(14,8,"Jump to Commit"))}}var _t=(()=>{class t extends H(G,Gt){constructor(e,n,i){super(),this.router=e,this.store=n,this.commitsApi=i,this.yUnit=bi.yUnit,this.commitDetails=new q([]),this.selectedCommitDetail=new q(null),this.selectedPatch=new q(null),this.selectedFile=this.selectedPatch.pipe(x(m=>m?{area:"commit",oldFilePath:m.patch.oldFilePath,newFilePath:m.patch.newFilePath}:null)),this.getCommitSummary=m=>m.message.split(`
`)[0]}ngOnChanges(e){if(!e.commits)return;let n=this.store.selectSnapshot(E.selectedRepositoryPath);if(!n)throw new ce;this.repositoryPath=n,this.commitsApi.getCommits(n,this.commits).pipe(A(this.destroyed$)).subscribe(m=>{this.commitDetails.next(m),m[0]&&this.selectedCommitDetail.next(m[0])});let i=this.store.selectSnapshot(E.selectedRemotes);if(!i)throw new Ke;this.remotes=i}patchChanged(e){let n=this.selectedCommitDetail.value;e.area!=="commit"||!n||n.patches.length===0||this.commitsApi.getPatch(this.repositoryPath,n.id,e.oldFilePath,e.newFilePath).pipe(x(i=>({repositoryPath:this.repositoryPath,patch:i,isUnstaged:!1})),L(i=>de.matches(i)?P(null):Je.matches(i)?P(null):ae(()=>i)),A(this.destroyed$)).subscribe(i=>{this.selectedPatch.value?.patch.newFilePath===i?.patch.newFilePath&&this.selectedPatch.value?.patch.oldFilePath===i?.patch.oldFilePath?this.selectedPatch.next(null):this.selectedPatch.next(i)})}copyToClipboard(e){navigator.clipboard.writeText(e??"")}jumpToCommit(e){this.store.dispatch([new ai(this.repositoryPath,e),new pi(this.repositoryPath,e)]).subscribe(()=>{this.router.navigate(["/standard/default"])})}trackCommitDetail(e,n){return n.id}static{this.\u0275fac=function(n){return new(n||t)(y(Me),y(T),y(ue))}}static{this.\u0275cmp=j({type:t,selectors:[["app-pull-request-commits-view"]],viewQuery:function(n,i){if(n&1&&He(tt,5),n&2){let m;Ge(m=Ue())&&(i.viewports=m)}},inputs:{commits:"commits"},features:[N,kt],decls:13,vars:9,consts:[["contextMenu",""],["id","pull-request-commits-view"],["min","200px",1,"left-cell"],[1,"viewport-wrapper"],[1,"viewport","messages-viewport",3,"itemSize"],[1,"messages"],[3,"selected","appContextMenu","appContextMenuData","click",4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[3,"patch","closed",4,"ngIf"],["min","234px",1,"right-cell"],[3,"commit","selectedFile","patchChanged",4,"ngIf"],[3,"click","appContextMenu","appContextMenuData"],[3,"matTooltip","remotes","email"],[1,"summary",3,"matTooltip"],[3,"closed","patch"],[3,"patchChanged","commit","selectedFile"],[1,"menu-panel"],[1,"menu-header",3,"matTooltip"],[1,"menu-item",3,"click","matTooltip"]],template:function(n,i){n&1&&(r(0,"app-grid",1)(1,"app-grid-cell",2)(2,"div",3)(3,"cdk-virtual-scroll-viewport",4)(4,"ul",5),C(5,$i,5,11,"li",6),p()()(),C(6,zi,1,2,"app-diff-view",7),l(7,"async"),p(),r(8,"app-grid-cell",8),C(9,Hi,1,2,"app-commit-detail-view",9),l(10,"async"),p()(),C(11,Gi,15,10,"ng-template",null,0,De)),n&2&&(o(3),a("itemSize",i.yUnit),o(2),a("cdkVirtualForOf",i.commitDetails)("cdkVirtualForTrackBy",i.trackCommitDetail),o(),a("ngIf",c(7,5,i.selectedPatch)),o(3),a("ngIf",c(10,7,i.selectedCommitDetail)))},dependencies:[Nt,$t,tt,J,Z,he,at,ti,pt,lt,_i,ft,z,ee],styles:[".viewport-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}.messages-viewport[_ngcontent-%COMP%]{contain:content;scrollbar-gutter:stable;height:100%}.messages[_ngcontent-%COMP%]{position:relative;font-size:0}.messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]{position:relative;cursor:pointer;height:28px;line-height:28px;padding-left:5px;padding-right:130px;user-select:none;white-space:nowrap}.messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{width:26px;height:26px;vertical-align:middle;margin-right:5px}.messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]{font-size:1rem;vertical-align:middle}app-diff-view[_ngcontent-%COMP%]{z-index:200;padding-left:10px}.dark-theme[_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover, .dark-theme   [_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:#2d2d2d}.dark-theme[_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%]{background-color:#424242}.dark-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#90a4ae;--bgColor: #1e1e1e}.dark-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date.selected.scrolled-to-top[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date.selected.scrolled-to-top[_ngcontent-%COMP%]{--bgColor: #424242}.dark-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{--bgColor: #424242}.light-theme[_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover, .light-theme   [_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.light-theme[_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .messages[_ngcontent-%COMP%] > li.selected[_ngcontent-%COMP%]{background-color:#eee}.light-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{color:#90a4ae;--bgColor: #fafafa}.light-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date.selected.scrolled-to-top[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   .top-date.selected.scrolled-to-top[_ngcontent-%COMP%]{--bgColor: #eeeeee}.light-theme[_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .floating-dates[_ngcontent-%COMP%]   li.selected[_ngcontent-%COMP%]{--bgColor: #eeeeee}"],data:{animation:[it("slideLeft",[Se(":enter",[Y({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),Oe("200ms",Y({transform:"translateX(0)"}))]),Se(":leave",[Y({position:"absolute",top:0,left:0,transform:"translateX(0)"}),Oe("200ms",Y({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return t})();function Ui(t,u){if(t&1){let e=Ce();r(0,"app-diff-view",5),V("closed",function(){le(e);let i=w();return se(i.selectedPatch.next(null))}),p()}if(t&2){let e=w();a("@slideLeft",void 0)("patch",e.selectedPatch)}}var Pt=(()=>{class t extends H(G){constructor(e,n){super(),this.store=e,this.commitsApi=n,this.selectedPatch=new q(null),this.selectedFile=this.selectedPatch.pipe(x(i=>i?{area:"commit",oldFilePath:i.patch.oldFilePath,newFilePath:i.patch.newFilePath}:null))}ngOnInit(){let e=this.store.selectSnapshot(E.selectedRepositoryPath);if(!e)throw new ce;this.repositoryPath=e}ngAfterViewInit(){let e=zt(this.patches,n=>n.oldFilePath?.toLowerCase()??n.newFilePath?.toLowerCase())[0];e&&setTimeout(()=>{this.changePatch(e.oldFilePath,e.newFilePath)},500)}changePatch(e,n){this.commitsApi.getCompareCommitsPatch(this.repositoryPath,this.fromCommitId,this.toCommitId,e,n).pipe(x(i=>({repositoryPath:this.repositoryPath,patch:i,isUnstaged:!1})),L(i=>de.matches(i)?P(null):Je.matches(i)?P(null):ae(()=>i)),A(this.destroyed$)).subscribe(i=>{this.selectedPatch.value?.patch.newFilePath===i?.patch.newFilePath&&this.selectedPatch.value?.patch.oldFilePath===i?.patch.oldFilePath?this.selectedPatch.next(null):this.selectedPatch.next(i)})}static{this.\u0275fac=function(n){return new(n||t)(y(T),y(ue))}}static{this.\u0275cmp=j({type:t,selectors:[["app-pull-request-patches-view"]],inputs:{fromCommitId:"fromCommitId",toCommitId:"toCommitId",patches:"patches"},features:[N],decls:7,vars:7,consts:[["id","pull-request-commits-view"],["min","200px",1,"left-cell"],[3,"patch","closed",4,"ngIf"],["min","234px",1,"right-cell"],[3,"selectedChanged","patches","selected"],[3,"closed","patch"]],template:function(n,i){n&1&&(r(0,"app-grid",0)(1,"app-grid-cell",1),C(2,Ui,1,2,"app-diff-view",2),l(3,"async"),p(),r(4,"app-grid-cell",3)(5,"app-patches-view",4),l(6,"async"),V("selectedChanged",function(d){return i.changePatch(d.oldFilePath,d.newFilePath)}),p()()()),n&2&&(o(2),a("ngIf",c(3,3,i.selectedPatch)),o(3),a("patches",i.patches)("selected",c(6,5,i.selectedFile)))},dependencies:[J,pt,lt,ft,gi,z],styles:["app-diff-view[_ngcontent-%COMP%]{z-index:200;padding-left:10px}app-patches-view[_ngcontent-%COMP%]{padding:16px;height:100%;display:flex;flex-direction:column;gap:10px}"],data:{animation:[it("slideLeft",[Se(":enter",[Y({position:"absolute",top:0,left:0,transform:"translateX(100%)"}),Oe("200ms",Y({transform:"translateX(0)"}))]),Se(":leave",[Y({position:"absolute",top:0,left:0,transform:"translateX(0)"}),Oe("200ms",Y({transform:"translateX(100%)"}))])])]},changeDetection:0})}}return t})();var Ri=t=>({branch:t});function Wi(t,u){if(t&1&&(r(0,"mat-option",11),h(1),p()),t&2){let e=u.$implicit;a("value",e),o(),vt(" ",e.owner,"/",e.repo," ")}}function Ji(t,u){if(t&1&&(r(0,"mat-option",11),h(1),p()),t&2){let e=u.$implicit;a("value",ie(2,Ri,e)),o(),M(e)}}function Ki(t,u){if(t&1&&(r(0,"mat-option",11),h(1),p()),t&2){let e=u.$implicit;a("value",e),o(),vt(" ",e.owner,"/",e.repo," ")}}function Yi(t,u){if(t&1&&(r(0,"mat-option",11),h(1),p()),t&2){let e=u.$implicit;a("value",ie(2,Ri,e)),o(),M(e)}}var Bi=(()=>{class t extends H(G){constructor(e,n,i,m,d){super(),this.store=e,this.bitbucketApiService=n,this.gitHubApiService=i,this.gitLabApiService=m,this.providerUrlMatcherService=d,this.filteredFromRepos=[],this.displayBranch=f=>f?f.branch:"",this.displayRepo=f=>f?`${f.owner}/${f.repo}`:""}ngOnInit(){let e=this.store.selectSnapshot(E.selectedRemotes)?.filter(n=>this.providerUrlMatcherService.matchProvider(n.url)?.type===this.integration.type);if(!e)throw new nt(new Ke);this.filteredFromRepos=e.flatMap(n=>{let i=this.providerUrlMatcherService.matchProvider(n.url);return i?.type!==this.integration.type?[]:{owner:i.type==="bitbucket"?i.workspace:i.type==="github"?i.owner:i.type==="gitlab"?i.namespace:"",repo:i.repo}}),this.filteredFromRepos[0]&&(this.controls.fromRepo.setValue(this.filteredFromRepos[0]),this.controls.toRepo.setValue(this.filteredFromRepos[0])),this.filteredFromBranches=Fe([this.controls.fromRepo.valueChanges.pipe(X(this.controls.fromRepo.value),pe(500,void 0,{leading:!0,trailing:!0}),B(n=>this.getBranches(n))),this.controls.fromBranch.valueChanges.pipe(X(this.controls.fromBranch.value),pe(500,void 0,{leading:!0,trailing:!0}))]).pipe(x(([n,i])=>typeof i=="string"?n.filter(m=>m.toLowerCase().includes(i.toLowerCase())):n)),this.filteredToRepos=this.controls.fromRepo.valueChanges.pipe(X(this.controls.fromRepo.value),pe(500,void 0,{leading:!0,trailing:!0}),B(n=>{let{owner:i,repo:m}=n??{};if(!i||!m)return P(this.filteredFromRepos);switch(this.integration.type){case"bitbucket":return this.bitbucketApiService.getRepository(i,m,void 0,this.integration).pipe(x(d=>{if(!d?.parent){let s=this.controls.fromRepo.value,_=this.controls.toRepo.value;return s?.owner===_?.owner&&s?.repo===_?.repo&&this.controls.toBranch.pristine&&d?.mainbranch&&this.controls.toBranch.setValue({branch:d.mainbranch.name}),this.filteredFromRepos}let[f,g]=d?.parent?.full_name.split("/")??[];return!f||!g?this.filteredFromRepos:(this.controls.toBranch.pristine&&d.parent?.mainbranch&&this.controls.toBranch.setValue({branch:d.parent.mainbranch.name}),[{owner:f,repo:g},...this.filteredFromRepos.filter(s=>s.owner!==f||s.repo!==g)])}));case"github":return this.gitHubApiService.getRepository(this.integration.token,i,m).pipe(x(d=>{if(!d?.parent){let s=this.controls.fromRepo.value,_=this.controls.toRepo.value;return s?.owner===_?.owner&&s?.repo===_?.repo&&this.controls.toBranch.pristine&&d&&this.controls.toBranch.setValue({branch:d.default_branch}),this.filteredFromRepos}let[f,g]=d?.parent?.full_name.split("/")??[];return!f||!g?this.filteredFromRepos:(this.controls.toBranch.pristine&&d.parent&&this.controls.toBranch.setValue({branch:d.parent.default_branch}),[{owner:f,repo:g},...this.filteredFromRepos.filter(s=>s.owner!==f||s.repo!==g)])}));case"gitlab":return this.gitLabApiService.getRepository(this.integration,i,m).pipe(x(d=>{if(!d?.forked_from_project){let s=this.controls.fromRepo.value,_=this.controls.toRepo.value;return s?.owner===_?.owner&&s?.repo===_?.repo&&this.controls.toBranch.pristine&&d&&this.controls.toBranch.setValue({branch:d.default_branch}),this.filteredFromRepos}let f=d?.forked_from_project?.namespace.path,g=d?.forked_from_project?.path;return!f||!g?this.filteredFromRepos:(this.controls.toBranch.pristine&&d.forked_from_project&&this.controls.toBranch.setValue({branch:d.forked_from_project.default_branch}),[{owner:f,repo:g},...this.filteredFromRepos.filter(s=>s.owner!==f||s.repo!==g)])}));default:throw new Error("Check not exhaustive.")}})),this.filteredToBranches=Fe([this.controls.toRepo.valueChanges.pipe(X(this.controls.toRepo.value),pe(500,void 0,{leading:!0,trailing:!0}),B(n=>this.getBranches(n))),this.controls.toBranch.valueChanges.pipe(X(this.controls.toBranch.value),pe(500,void 0,{leading:!0,trailing:!0}))]).pipe(x(([n,i])=>typeof i=="string"?n.filter(m=>m.toLowerCase().includes(i.toLowerCase())):n))}getBranches(e){let{owner:n,repo:i}=e??{};if(!n||!i)return P([]);switch(this.integration.type){case"bitbucket":return this.bitbucketApiService.getBranches(this.integration,n,i).pipe(x(m=>m?.values.map(({name:d})=>d)??[]),L(()=>P([])));case"github":return this.gitHubApiService.getBranches(this.integration.token,n,i).pipe(x(m=>m?.map(({name:d})=>d)??[]),L(()=>P([])));case"gitlab":return this.gitLabApiService.getBranches(this.integration,n,i).pipe(x(m=>m?.map(({name:d})=>d)??[]),L(()=>P([])));default:throw new Error("Check not exhaustive.")}}static{this.\u0275fac=function(n){return new(n||t)(y(T),y(Ie),y(Re),y(Be),y(ei))}}static{this.\u0275cmp=j({type:t,selectors:[["app-pull-request-select-view"]],inputs:{integration:"integration",controls:"controls"},features:[N],decls:33,vars:30,consts:[["autoToBranch","matAutocomplete"],["autoFromBranch","matAutocomplete"],["subscriptSizing","dynamic",1,"to-repo"],["required","",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"to-branch"],["type","text","matInput","","required","",3,"formControl","matAutocomplete"],[3,"displayWith"],["subscriptSizing","dynamic",1,"from-repo"],["subscriptSizing","dynamic",1,"from-branch"],["type","text","matInput","","required","","cdkFocusInitial","",3,"formControl","matAutocomplete"],[3,"value"]],template:function(n,i){if(n&1&&(r(0,"mat-form-field",2)(1,"mat-label"),h(2),l(3,"translate"),p(),r(4,"mat-select",3),C(5,Wi,2,3,"mat-option",4),l(6,"async"),p()(),r(7,"mat-form-field",5)(8,"mat-label"),h(9),l(10,"translate"),p(),b(11,"input",6),r(12,"mat-autocomplete",7,0),C(14,Ji,2,4,"mat-option",4),l(15,"async"),p()(),r(16,"mat-icon"),h(17,"arrow_back"),p(),r(18,"mat-form-field",8)(19,"mat-label"),h(20),l(21,"translate"),p(),r(22,"mat-select",3),C(23,Ki,2,3,"mat-option",4),p()(),r(24,"mat-form-field",9)(25,"mat-label"),h(26),l(27,"translate"),p(),b(28,"input",10),r(29,"mat-autocomplete",7,1),C(31,Yi,2,4,"mat-option",4),l(32,"async"),p()()),n&2){let m=me(13),d=me(30);o(2),M(c(3,16,"Base Repository")),o(2),a("formControl",i.controls.toRepo),o(),a("ngForOf",c(6,18,i.filteredToRepos)),o(4),M(c(10,20,"Base Branch")),o(2),a("formControl",i.controls.toBranch)("matAutocomplete",m),o(),a("displayWith",i.displayBranch),o(2),a("ngForOf",c(15,22,i.filteredToBranches)),o(6),M(c(21,24,"Head Repository")),o(2),a("formControl",i.controls.fromRepo),o(),a("ngForOf",i.filteredFromRepos),o(3),M(c(27,26,"Head Branch")),o(2),a("formControl",i.controls.fromBranch)("matAutocomplete",d),o(),a("displayWith",i.displayBranch),o(2),a("ngForOf",c(32,28,i.filteredFromBranches))}},dependencies:[ci,et,di,ge,fe,Ve,mt,Qe,Ye,we,Ze,xe,Z,z,ee],styles:["[_nghost-%COMP%]{display:flex;gap:10px;align-items:center}.to-repo[_ngcontent-%COMP%], .from-repo[_ngcontent-%COMP%]{min-width:140px;flex:2 1 auto}.to-branch[_ngcontent-%COMP%], .from-branch[_ngcontent-%COMP%]{min-width:100px;flex:1 2 auto}"],changeDetection:0})}}return t})();var ki=t=>({count:t});function on(t,u){t&1&&(r(0,"mat-error"),h(1),l(2,"translate"),p()),t&2&&(o(),M(c(2,1,"Title is required")))}function rn(t,u){if(t&1&&(r(0,"mat-tab",4),l(1,"translate"),r(2,"div",16),b(3,"app-pull-request-commits-view",17),p()()),t&2){let e=w().ngIf;W("label",ne(1,2,"Commits (_count_)",ie(5,ki,e.commits.length))),o(3),a("commits",e.commits)}}function an(t,u){if(t&1&&(r(0,"mat-tab",4),l(1,"translate"),b(2,"app-pull-request-patches-view",18),p()),t&2){let e=w().ngIf;W("label",ne(1,4,"Files changed (_count_)",ie(7,ki,e.patches.length))),o(2),a("fromCommitId",e.fromCommitId)("toCommitId",e.toCommitId)("patches",e.patches)}}function pn(t,u){if(t&1&&(qe(0),C(1,rn,4,7,"mat-tab",15)(2,an,3,9,"mat-tab",15),Ae()),t&2){let e=u.ngIf,n=w();o(),a("ngIf",n.hasCommits(e)),o(),a("ngIf",n.hasPatches(e))}}function ln(t,u){if(t&1&&(r(0,"span",21),l(1,"async"),l(2,"translate"),h(3),l(4,"translate"),p()),t&2){let e=w(2);a("matTooltip",c(2,4,c(1,2,e.compare)===null?"Information unavailable in the repository, view in the browser instead":"Select valid branches to compare")),o(3),$(" ",c(4,6,"Commits")," ")}}function sn(t,u){if(t&1&&(r(0,"span",21),l(1,"async"),l(2,"translate"),h(3),l(4,"translate"),p()),t&2){let e=w(2);a("matTooltip",c(2,4,c(1,2,e.compare)===null?"Information unavailable in the repository, view in the browser instead":"Select valid branches to compare")),o(3),$(" ",c(4,6,"Files changed")," ")}}function mn(t,u){t&1&&(qe(0),r(1,"mat-tab",19),C(2,ln,5,8,"ng-template",20),p(),r(3,"mat-tab",19),C(4,sn,5,8,"ng-template",20),p(),Ae())}function cn(t,u){t&1&&b(0,"mat-spinner",22)}function dn(t,u){t&1&&(r(0,"span"),h(1),l(2,"translate"),p()),t&2&&(o(),M(c(2,1,"View in browser")))}function hn(t,u){t&1&&b(0,"mat-spinner",22)}function un(t,u){t&1&&(r(0,"span"),h(1),l(2,"translate"),p()),t&2&&(o(),M(c(2,1,"Create Pull Request")))}var Vi=(()=>{class t extends H(G){constructor(e,n,i,m,d,f){super(),this.route=e,this.store=n,this.commitsApi=i,this.bitbucketApiService=m,this.gitHubApiService=d,this.gitLabApiService=f,this.form=new jt({fromRepo:new K(null,ye.required),fromBranch:new K(null,ye.required),toRepo:new K(null,ye.required),toBranch:new K(null,ye.required),title:new K(null,ye.required),description:new K(null),draft:new K(!1,{nonNullable:!0})}),this.compare=new q(void 0),this.loadingCompare=new q(!1),this.creatingPullRequest=new q(!1),this.hasCommits=g=>!!g.commits,this.hasPatches=g=>!!g.patches,this.getBranch=g=>typeof g=="string"?g:g.branch}ngOnInit(){let e=this.route.snapshot.paramMap.get("type");if(e!=="bitbucket"&&e!=="github"&&e!=="gitlab")throw new We(e);let n=this.route.snapshot.paramMap.get("integrationId"),i=this.store.selectSnapshot(ke.integrations).find(d=>d.type===e&&d.id==n);if(!i)throw new Dt(e,n);this.integration=i;let m=this.store.selectSnapshot(E.selectedRepositoryPath);if(!m)throw new ce;Fe([this.form.controls.toRepo.valueChanges.pipe(X(this.form.controls.toRepo.value)),this.form.controls.toBranch.valueChanges.pipe(X(this.form.controls.toBranch.value)),this.form.controls.fromRepo.valueChanges.pipe(X(this.form.controls.fromRepo.value)),this.form.controls.fromBranch.valueChanges.pipe(X(this.form.controls.fromBranch.value))]).pipe(pe(500,void 0,{leading:!0,trailing:!0}),x(([d,f,g,s])=>{let{owner:_,repo:S}=this.getOwnerRepo(d),{owner:I,repo:k}=this.getOwnerRepo(g);return _&&S&&f&&I&&k&&s?{toOwner:_,toRepo:S,toBranch:f,fromOwner:I,fromRepo:k,fromBranch:s}:null}),It(Ht),Bt(()=>{this.loadingCompare.next(!0)}),B(({toOwner:d,toRepo:f,toBranch:g,fromOwner:s,fromRepo:_,fromBranch:S})=>{switch(this.integration.type){case"bitbucket":let I=this.getBranch(S),k=this.getBranch(g);return d!==s||f!==_?P({url:`https://bitbucket.org/${d}/${f}/branches/compare/${s}/${_}:${I}%0D${d}/${f}:${k}`}):this.bitbucketApiService.compareCommits(d,f,I,k,"values.hash,values.parents.hash").pipe(B(v=>{let O=v.values[0]?.hash,R=v.values[v.values.length-1]?.parents[0]?.hash,U={url:`https://bitbucket.org/${d}/${f}/branches/compare/${I}..${k}`,fromCommitId:O,toCommitId:R,commits:v.values.map(Q=>Q.hash)};return O&&R?this.commitsApi.compareCommits(m,O,R).pipe(x(Q=>re(oe({},U),{fromCommitId:O,toCommitId:R,patches:Q}))):P(null)}));case"github":return this.gitHubApiService.compare(this.integration.token,d,f,this.getBranch(g),s,_,this.getBranch(S)).pipe(B(v=>{let O=v?.commits[v.commits.length-1]?.sha,R=v?.base_commit.sha;if(!v)return P(null);let U={url:v.html_url,fromCommitId:O,toCommitId:R,commits:v.commits.map(Q=>Q.sha)};return v&&O&&R&&v.commits.length<250?this.commitsApi.compareCommits(m,O,R).pipe(x(Q=>re(oe({},U),{fromCommitId:O,toCommitId:R,patches:Q}))):P(null)}));case"gitlab":let F=this.integration;return this.gitLabApiService.getProject(F,d,f).pipe(B(v=>this.gitLabApiService.compare(F,s,_,this.getBranch(S),this.getBranch(g),v.id)),B(v=>{let O=v?.commit?.id,R=v?.commits[0]?.parent_ids[0];if(!v)return P(null);let U={url:v.web_url,fromCommitId:O,toCommitId:R,commits:v.commits.map(Q=>Q.id)};return v&&O&&R?this.commitsApi.compareCommits(m,O,R).pipe(x(Q=>re(oe({},U),{fromCommitId:O,toCommitId:R,patches:Q}))):P(null)}));default:let D=this.integration;throw new Error(`Check not exhaustive '${D}'.`)}}),L(d=>de.matches(d)?P(null):ae(()=>d)),mi(()=>{this.loadingCompare.next(!1)}),A(this.destroyed$)).subscribe(d=>{this.compare.next(d),this.loadingCompare.next(!1)})}close(){history.back()}openCompareInBrowser(){let e=this.compare.value?.url;e&&window.open(e)}createPullRequest(){let{toRepo:e,toBranch:n,fromRepo:i,fromBranch:m,title:d,description:f}=this.form.value,{owner:g,repo:s}=this.getOwnerRepo(e),{owner:_,repo:S}=this.getOwnerRepo(i);if(this.form.invalid||!g||!s||!n||!_||!S||!m||!d)throw new nt(new Lt);this.creatingPullRequest.next(!0);let I;switch(this.integration.type){case"bitbucket":I=this.bitbucketApiService.createPullRequest(this.integration,g,s,{title:d,description:f??void 0,source:{branch:{name:this.getBranch(m)},repository:{full_name:`${_}/${S}`}},destination:{branch:{name:this.getBranch(n)}}});break;case"github":I=this.gitHubApiService.createPullRequest(this.integration.token,g,s,{head:`${_}:${this.getBranch(m)}`,head_repo:S,base:this.getBranch(n),title:d,body:f??void 0});break;case"gitlab":let k=this.integration;I=this.gitLabApiService.getRepository(k,g,s).pipe(B(D=>this.gitLabApiService.createMergeRequest(k,_,S,{source_branch:this.getBranch(m),target_branch:this.getBranch(n),target_project_id:D.id??void 0,title:d,description:f??void 0})));break;default:let F=this.integration;throw new Error(`Check not exhaustive '${F}'.`)}I.pipe($e(()=>{this.creatingPullRequest.next(!1)})).subscribe(()=>{this.close()})}getOwnerRepo(e){if(typeof e=="string"){let n=e.split("/"),[i,m]=n;return!i||!m||n.length!==2?{owner:void 0,repo:void 0}:{owner:i,repo:m}}return e??{owner:void 0,repo:void 0}}static{this.\u0275fac=function(n){return new(n||t)(y(Xe),y(T),y(ue),y(Ie),y(Re),y(Be))}}static{this.\u0275cmp=j({type:t,selectors:[["ng-component"]],features:[N],decls:47,vars:59,consts:[["type","button","mat-icon-button","","matTooltip","Go Back",1,"back-btn","app-icon-button-md",3,"click"],[1,"mat-headline-6","text"],[3,"controls","integration"],[1,"tabs",3,"disablePagination","mat-stretch-tabs","preserveContent"],[3,"label"],[1,"tab","description"],[1,"title-field"],["type","text","matInput","","required","",3,"formControl"],[4,"ngIf"],[1,"description-field"],["matInput","","rows","5",3,"placeholder","formControl"],["type","button","mat-flat-button","","color","accent",3,"click","disabled"],["diameter","24",4,"ngIf"],[3,"matTooltip"],["type","button","mat-flat-button","","color","primary",3,"click","disabled"],[3,"label",4,"ngIf"],[1,"tab"],[3,"commits"],[3,"fromCommitId","toCommitId","patches"],["disabled",""],["mat-tab-label",""],[1,"disabled-tab",3,"matTooltip"],["diameter","24"]],template:function(n,i){n&1&&(r(0,"header")(1,"button",0),V("click",function(){return i.close()}),r(2,"mat-icon"),h(3,"arrow_back"),p()(),r(4,"span",1),h(5),l(6,"translate"),p()(),r(7,"main"),b(8,"app-pull-request-select-view",2),r(9,"mat-tab-group",3)(10,"mat-tab",4),l(11,"translate"),r(12,"div",5)(13,"mat-form-field",6)(14,"mat-label"),h(15),l(16,"translate"),p(),b(17,"input",7),C(18,on,3,3,"mat-error",8),p(),r(19,"mat-form-field",9),b(20,"textarea",10),l(21,"translate"),p()()(),C(22,pn,3,2,"ng-container",8),l(23,"async"),C(24,mn,5,0,"ng-container",8),l(25,"async"),p()(),r(26,"footer")(27,"button",11),l(28,"async"),l(29,"async"),l(30,"async"),V("click",function(){return i.openCompareInBrowser()}),C(31,cn,1,0,"mat-spinner",12),l(32,"async"),C(33,dn,3,3,"span",8),l(34,"async"),p(),r(35,"span",13),l(36,"async"),l(37,"translate"),l(38,"translate"),r(39,"button",14),l(40,"async"),l(41,"async"),l(42,"async"),V("click",function(){return i.createPullRequest()}),C(43,hn,1,0,"mat-spinner",12),l(44,"async"),C(45,un,3,3,"span",8),l(46,"async"),p()()()),n&2&&(o(5),M(c(6,21,"Create Pull Request")),o(3),a("controls",i.form.controls)("integration",i.integration),o(),a("disablePagination",!0)("mat-stretch-tabs",!1)("preserveContent",!0),o(),W("label",c(11,23,"Description")),o(5),M(c(16,25,"Title")),o(2),a("formControl",i.form.controls.title),o(),a("ngIf",i.form.controls.title.hasError("required")),o(2),W("placeholder",c(21,27,"Leave a comment...")),a("formControl",i.form.controls.description),o(2),a("ngIf",c(23,29,i.compare)),o(2),a("ngIf",c(25,31,i.compare)===void 0),o(3),a("disabled",c(28,33,i.loadingCompare)||c(29,35,i.compare)===void 0||c(30,37,i.compare)===null),o(4),a("ngIf",c(32,39,i.loadingCompare)),o(2),a("ngIf",c(34,41,i.loadingCompare)===!1),o(2),a("matTooltip",c(36,43,i.compare)===void 0?c(37,45,"Select valid branches to compare"):i.form.invalid?c(38,47,"Title is required"):""),o(4),a("disabled",i.form.invalid||c(40,49,i.loadingCompare)||c(41,51,i.compare)===void 0||c(42,53,i.creatingPullRequest)),o(4),a("ngIf",c(44,55,i.creatingPullRequest)),o(2),a("ngIf",c(46,57,i.creatingPullRequest)===!1))},dependencies:[ge,fe,Jt,Ve,dt,ui,ht,ut,J,Ye,we,Ze,xe,ot,rt,Z,he,_t,Pt,Bi,z,ee],styles:["[_nghost-%COMP%]{padding:10px;display:flex;flex-direction:column;gap:20px;min-height:0}header[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-items:center;gap:10px}header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{flex:0 0 auto}header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin:0}main[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0;display:flex;flex-direction:column;gap:10px}main[_ngcontent-%COMP%]   app-pull-request-select-view[_ngcontent-%COMP%]{flex:0 0 auto}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{flex-grow:1}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{margin-top:15px;height:calc(100% - 15px)}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;justify-content:stretch}main[_ngcontent-%COMP%]   .disabled-tab[_ngcontent-%COMP%]{pointer-events:auto}footer[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;gap:10px}"],changeDetection:0})}}return t})();var Ei=t=>({count:t});function fn(t,u){t&1&&b(0,"mat-spinner")}function gn(t,u){if(t&1&&(r(0,"mat-card",24),h(1),p()),t&2){let e=w().ngIf;o(),M(e.description)}}function Cn(t,u){if(t&1&&(r(0,"mat-tab",9),l(1,"translate"),r(2,"div",10),b(3,"app-pull-request-commits-view",25),p()()),t&2){let e=w().ngIf;W("label",ne(1,2,"Commits (_count_)",ie(5,Ei,e.commits.length))),o(3),a("commits",e.commits)}}function _n(t,u){t&1&&(b(0,"mat-tab",26),l(1,"translate")),t&2&&W("label",c(1,1,"Commits"))}function Pn(t,u){if(t&1&&(r(0,"mat-tab",9),l(1,"translate"),b(2,"app-pull-request-patches-view",27),p()),t&2){let e=w().ngIf;W("label",ne(1,4,"Files changed (_count_)",ie(7,Ei,e.patches.length))),o(2),a("fromCommitId",e.fromCommitId)("toCommitId",e.toCommitId)("patches",e.patches)}}function vn(t,u){t&1&&(b(0,"mat-tab",26),l(1,"translate")),t&2&&W("label",c(1,1,"Files changed"))}function bn(t,u){if(t&1&&(qe(0),r(1,"span",7),h(2),p(),r(3,"mat-tab-group",8)(4,"mat-tab",9),l(5,"translate"),r(6,"div",10)(7,"div",11)(8,"mat-form-field",12)(9,"mat-label"),h(10),l(11,"translate"),p(),b(12,"input",13),p(),r(13,"mat-form-field",14)(14,"mat-label"),h(15),l(16,"translate"),p(),b(17,"input",13),p(),r(18,"mat-icon"),h(19,"arrow_back"),p(),r(20,"mat-form-field",15)(21,"mat-label"),h(22),l(23,"translate"),p(),b(24,"input",13),p(),r(25,"mat-form-field",16)(26,"mat-label"),h(27),l(28,"translate"),p(),b(29,"input",13),p()(),r(30,"div",17)(31,"div",18),h(32),l(33,"translate"),b(34,"img",19),r(35,"span",20),h(36),p(),b(37,"br"),p(),r(38,"div",21),l(39,"translateDate"),h(40),l(41,"translate"),r(42,"span",20),h(43),l(44,"translateDate"),p(),h(45),l(46,"translate"),r(47,"span",20),h(48),l(49,"translateDate"),p()()(),C(50,gn,2,1,"mat-card",22),p()(),C(51,Cn,4,7,"mat-tab",23)(52,_n,2,3,"ng-template",null,0,De)(54,Pn,3,9,"mat-tab",23)(55,vn,2,3,"ng-template",null,1,De),p(),Ae()),t&2){let e=u.ngIf,n=me(53),i=me(56);o(2),M(e.title),o(),a("disablePagination",!0)("mat-stretch-tabs",!1)("preserveContent",!0),o(),W("label",c(5,28,"!pull request! Details")),o(6),M(c(11,30,"Base Repository")),o(2),a("value",e.toOwner+"/"+e.toRepo),o(3),M(c(16,32,"Base Branch")),o(2),a("value",e.toBranch),o(5),M(c(23,34,"Head Repository")),o(2),a("value",e.fromOwner+"/"+e.fromRepo),o(3),M(c(28,36,"Head Branch")),o(2),a("value",e.fromBranch),o(2),a("matTooltip",e.authorName),o(),$(" ",c(33,38,"authored by")," "),o(2),a("src",e.authorAvatar,Vt)("matTooltip",e.authorName),o(2),M(e.authorName),o(2),a("matTooltip",ne(39,40,e.date,"z")||""),o(2),$(" ",c(41,43,"on !date!")," "),o(3),M(ne(44,45,e.date,"longDate")),o(2),$(" ",c(46,48,"at !time!")," "),o(3),M(ne(49,50,e.date,"HH:mm")),o(2),a("ngIf",e.description),o(),a("ngIf",e.commits)("ngIfElse",n),o(3),a("ngIf",e.patches)("ngIfElse",i)}}function Mn(t,u){t&1&&b(0,"mat-spinner",28)}function yn(t,u){t&1&&(r(0,"span"),h(1),l(2,"translate"),p()),t&2&&(o(),M(c(2,1,"View in browser")))}var Ti=(()=>{class t extends H(G){constructor(e,n,i,m,d,f){super(),this.route=e,this.store=n,this.commitsApi=i,this.bitbucketApiService=m,this.gitHubApiService=d,this.gitLabApiService=f,this.pullRequest=new q(void 0),this.loading=new q(!1)}ngOnInit(){let e=this.route.snapshot.paramMap.get("type");if(e!=="bitbucket"&&e!=="github"&&e!=="gitlab")throw new We(e);let n=this.route.snapshot.paramMap.get("owner")??"",i=this.route.snapshot.paramMap.get("repo")??"",m=this.route.snapshot.paramMap.get("id")??"",d=this.store.selectSnapshot(E.selectedRepositoryPath);if(!d)throw new ce;let f;switch(e){case"bitbucket":f=this.bitbucketApiService.getPullRequest(n,i,parseInt(m,10)).pipe(B(s=>{if(!s)return P(null);let[_,S]=s.source.repository.full_name.split("/")??[],I=s.source.commit.hash,[k,F]=s.destination.repository.full_name.split("/")??[],D=s.destination.commit.hash;if(!_||!S||!k||!F)return P(null);let v={url:s.links.html.href,title:s.title,description:s.description,authorName:s.author.display_name,authorAvatar:s.author.links.avatar.href,date:new Date(s.created_on),fromOwner:_,fromRepo:S,fromBranch:s.source.branch.name,fromCommitId:I,toOwner:k,toRepo:F,toBranch:s.destination.branch.name,toCommitId:D};return this.bitbucketApiService.getPullRequestCommits(n,i,parseInt(m,10)).pipe(B(O=>O?this.commitsApi.compareCommits(d,I,D).pipe(x(R=>re(oe({},v),{commits:O.values.map(U=>U.hash),patches:R}))):P(v)))}));break;case"github":f=this.gitHubApiService.getPullRequest(n,i,parseInt(m,10)).pipe(B(s=>{if(!s)return P(null);let[_,S]=s.head.repo.full_name.split("/")??[],I=s.head.sha,[k,F]=s.base.repo.full_name.split("/")??[],D=s.base.sha;if(!_||!S||!k||!F)return P(null);let v={url:s.html_url,title:s.title,description:s.body,authorName:s.user.login,authorAvatar:s.user.avatar_url,date:new Date(s.created_at),fromOwner:_,fromRepo:S,fromBranch:s.head.ref,fromCommitId:I,toOwner:k,toRepo:F,toBranch:s.base.ref,toCommitId:D};return this.gitHubApiService.getPullRequestCommits(n,i,parseInt(m,10)).pipe(B(O=>O&&O.length<250?this.commitsApi.compareCommits(d,I,D).pipe(x(R=>re(oe({},v),{commits:O.map(U=>U.sha),patches:R}))):P(v)))}));break;case"gitlab":f=this.gitLabApiService.getMergeRequest(n,i,parseInt(m,10)).pipe(B(s=>s?Ot([this.gitLabApiService.getProjectById(s.source_project_id),this.gitLabApiService.getProjectById(s.target_project_id)]).pipe(x(([_,S])=>_&&S?{source:_,target:S,pullRequest:s}:null)):P(null)),B(s=>{if(!s)return P(null);let[_,S]=s.source.path_with_namespace.split("/")??[],I=s.pullRequest.diff_refs.head_sha,[k,F]=s.target.path_with_namespace.split("/")??[],D=s.pullRequest.diff_refs.base_sha;if(!_||!S||!k||!F)return P(null);let v={url:s.pullRequest.web_url,title:s.pullRequest.title,description:s.pullRequest.description,authorName:s.pullRequest.author.name,authorAvatar:s.pullRequest.author.avatar_url,date:new Date(s.pullRequest.created_at),fromOwner:_,fromRepo:S,fromBranch:s.pullRequest.source_branch,fromCommitId:I,toOwner:k,toRepo:F,toBranch:s.pullRequest.target_branch,toCommitId:D};return this.gitLabApiService.getPullRequestCommits(n,i,parseInt(m,10)).pipe(B(O=>O?this.commitsApi.compareCommits(d,I,D).pipe(x(R=>re(oe({},v),{commits:O.map(U=>U.id),patches:R}))):P(v)))}));break;default:let g=e;throw new Error(`Check not exhaustive '${g}'.`)}this.loading.next(!0),f.pipe(L(g=>de.matches(g)?P(null):ae(()=>g)),Rt(1),A(this.destroyed$),$e(()=>{this.loading.next(!1)})).subscribe(g=>{this.pullRequest.next(g)})}openInBrowser(){let e=this.pullRequest.value?.url;e&&window.open(e)}close(){history.back()}static{this.\u0275fac=function(n){return new(n||t)(y(Xe),y(T),y(ue),y(Ie),y(Re),y(Be))}}static{this.\u0275cmp=j({type:t,selectors:[["ng-component"]],features:[N],decls:20,vars:20,consts:[["emptyCommitsTab",""],["emptyPatchesTab",""],["type","button","mat-icon-button","","matTooltip","Go Back",1,"back-btn","app-icon-button-md",3,"click"],[1,"mat-headline-6","text"],[4,"ngIf"],["type","button","mat-flat-button","","color","accent",3,"click","disabled"],["diameter","24",4,"ngIf"],[1,"mat-headline-4","title"],[1,"tabs",3,"disablePagination","mat-stretch-tabs","preserveContent"],[3,"label"],[1,"tab"],[1,"repos"],["subscriptSizing","dynamic",1,"to-repo"],["type","text","matInput","","readonly","",3,"value"],["subscriptSizing","dynamic",1,"to-branch"],["subscriptSizing","dynamic",1,"from-repo"],["subscriptSizing","dynamic",1,"from-branch"],[1,"created"],[1,"author",3,"matTooltip"],[1,"avatar",3,"src","matTooltip"],[1,"highlight"],[1,"date",3,"matTooltip"],["class","description",4,"ngIf"],[3,"label",4,"ngIf","ngIfElse"],[1,"description"],[3,"commits"],["disabled","",3,"label"],[3,"fromCommitId","toCommitId","patches"],["diameter","24"]],template:function(n,i){n&1&&(r(0,"header")(1,"button",2),V("click",function(){return i.close()}),r(2,"mat-icon"),h(3,"arrow_back"),p()(),r(4,"span",3),h(5),l(6,"translate"),p()(),r(7,"main"),C(8,fn,1,0,"mat-spinner",4),l(9,"async"),C(10,bn,57,53,"ng-container",4),l(11,"async"),p(),r(12,"footer")(13,"button",5),l(14,"async"),l(15,"async"),V("click",function(){return i.openInBrowser()}),C(16,Mn,1,0,"mat-spinner",6),l(17,"async"),C(18,yn,3,3,"span",4),l(19,"async"),p()()),n&2&&(o(5),M(c(6,6,"Viewing Pull Request")),o(3),a("ngIf",c(9,8,i.loading)),o(2),a("ngIf",c(11,10,i.pullRequest)),o(3),a("disabled",c(14,12,i.loading)||c(15,14,i.pullRequest)===null),o(3),a("ngIf",c(17,16,i.loading)),o(2),a("ngIf",c(19,18,i.loading)===!1))},dependencies:[ge,fe,Ve,dt,ht,ut,J,ot,rt,Wt,Z,he,_t,Pt,z,ii,ee],styles:["[_nghost-%COMP%]{padding:10px;display:flex;flex-direction:column;gap:20px;min-height:0}header[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;align-items:center;gap:10px}header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]{flex:0 0 auto}header[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin:0}main[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0;display:flex;flex-direction:column;gap:10px}main[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-bottom:10px}main[_ngcontent-%COMP%]   .repos[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;margin-bottom:20px}main[_ngcontent-%COMP%]   .repos[_ngcontent-%COMP%]   .to-repo[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   .repos[_ngcontent-%COMP%]   .from-repo[_ngcontent-%COMP%]{min-width:140px;flex:2 1 auto}main[_ngcontent-%COMP%]   .repos[_ngcontent-%COMP%]   .to-branch[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   .repos[_ngcontent-%COMP%]   .from-branch[_ngcontent-%COMP%]{min-width:100px;flex:1 2 auto}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]{margin-bottom:20px}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{display:inline-block}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{border-radius:10%;width:auto;height:1.5625rem;aspect-ratio:1/1;margin:0 3px 0 5px;vertical-align:bottom}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{font-size:1.25rem}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{margin-left:5px}main[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{font-size:1.25rem}main[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{padding:10px}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]{flex:1 1 auto;min-height:0}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{flex-grow:1}main[_ngcontent-%COMP%]   .tabs[_ngcontent-%COMP%]   .tab[_ngcontent-%COMP%]{margin-top:15px;height:calc(100% - 15px)}main[_ngcontent-%COMP%]   .disabled-tab[_ngcontent-%COMP%]{pointer-events:auto}footer[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;gap:10px}.dark-theme[_nghost-%COMP%]   .author[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .author[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   .date[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .date[_ngcontent-%COMP%]{color:#ffffffb3}.dark-theme[_nghost-%COMP%]   .author[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .author[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .dark-theme[_nghost-%COMP%]   .date[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   .date[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{color:#fff}.light-theme[_nghost-%COMP%]   .author[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .author[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   .date[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .date[_ngcontent-%COMP%]{color:#0000008a}.light-theme[_nghost-%COMP%]   .author[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .author[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .light-theme[_nghost-%COMP%]   .date[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   .date[_ngcontent-%COMP%]   .highlight[_ngcontent-%COMP%]{color:#000000de}"],changeDetection:0})}}return t})();var Fi=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=be({type:t})}static{this.\u0275inj=Pe({imports:[hi,Yt,Kt,Zt,si,li,ct,fi,st,Pi,vi,Ci]})}}return t})();var xt=(()=>{class t{constructor(e,n){this.router=e,this.authService=n}canActivate(){return this.authService.accessLevel.value==="pro"?!0:this.router.parseUrl("/standard/open-repository")}static{this.\u0275fac=function(n){return new(n||t)(ve(Me),ve(Qt))}}static{this.\u0275prov=ze({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var _e=(()=>{class t{constructor(e,n){this.router=e,this.store=n}canActivate(){return this.store.selectSnapshot(E.selectedRepositoryPath)?!0:this.router.parseUrl("/standard/open-repository")}static{this.\u0275fac=function(n){return new(n||t)(ve(Me),ve(T))}}static{this.\u0275prov=ze({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var wn=["header"],xn=()=>["/settings"];function On(t,u){if(t&1&&b(0,"app-avatar",7),t&2){let e=w().ngIf;a("email",e.email)}}function Sn(t,u){if(t&1&&(r(0,"span"),C(1,On,1,1,"app-avatar",6),h(2),p()),t&2){let e=u.ngIf;o(),a("ngIf",e.email),o(),$(" ",e.profileName," ")}}function In(t,u){if(t&1&&b(0,"app-avatar",10),t&2){let e=w().$implicit;a("email",e.value.email)}}function Rn(t,u){if(t&1&&(r(0,"mat-option",8),C(1,In,1,1,"app-avatar",9),h(2),p()),t&2){let e=u.$implicit;a("value",e.key),o(),a("ngIf",e.value.email),o(),$(" ",e.value.profileName," ")}}var qi=(()=>{class t extends H(G){constructor(e){super(),this.store=e,this.selectedProfileControl=new K(null)}ngOnInit(){this.selectedProfileId.pipe(A(this.destroyed$)).subscribe(e=>{this.selectedProfileControl.setValue(e,{emitEvent:!1})}),this.selectedProfileControl.valueChanges.pipe(A(this.destroyed$)).subscribe(e=>{e!==null&&this.store.dispatch(new Ut(e))}),St(this.headerElement.nativeElement,"wheel",{passive:!0}).pipe(A(this.destroyed$)).subscribe(e=>{this.headerElement.nativeElement.scrollLeft+=e.deltaY})}static{this.\u0275fac=function(n){return new(n||t)(y(T))}}static{this.\u0275cmp=j({type:t,selectors:[["ng-component"]],viewQuery:function(n,i){if(n&1&&He(wn,7),n&2){let m;Ge(m=Ue())&&(i.headerElement=m.first)}},features:[N],decls:19,vars:17,consts:[["header",""],["subscriptSizing","dynamic",1,"profile-selector"],[3,"formControl"],[4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"settings-icon",3,"routerLink","matTooltip"],[3,"email",4,"ngIf"],[3,"email"],[3,"value"],["class","profile-select-avatar",3,"email",4,"ngIf"],[1,"profile-select-avatar",3,"email"]],template:function(n,i){n&1&&(r(0,"header",null,0),b(2,"app-repository-tabs-view"),r(3,"mat-form-field",1)(4,"mat-label"),h(5),l(6,"translate"),p(),r(7,"mat-select",2)(8,"mat-select-trigger"),C(9,Sn,3,2,"span",3),l(10,"async"),p(),C(11,Rn,3,3,"mat-option",4),l(12,"async"),l(13,"keyvalue"),p()(),r(14,"mat-icon",5),l(15,"translate"),h(16,"settings"),p()(),b(17,"router-outlet")(18,"app-notification-tray-view")),n&2&&(o(5),M(c(6,6,"Select Profile")),o(2),a("formControl",i.selectedProfileControl),o(2),a("ngIf",c(10,8,i.selectedProfile)),o(2),a("ngForOf",c(13,12,c(12,10,i.profiles))),o(3),a("routerLink",Tt(16,xn))("matTooltip",c(15,14,"Settings")))},dependencies:[ge,fe,mt,ri,et,Qe,J,we,xe,Z,he,at,ni,Mi,qt,At,z,Ft,ee],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}header[_ngcontent-%COMP%]{display:flex;height:50px;min-height:50px;border-bottom:1px solid transparent;overflow-x:auto;overflow-y:hidden}header[_ngcontent-%COMP%]::-webkit-scrollbar{height:1px}header[_ngcontent-%COMP%]   app-repository-tabs-view[_ngcontent-%COMP%]{flex:1 0 auto}header[_ngcontent-%COMP%]   app-repository-tabs-view[_ngcontent-%COMP%]     .mat-mdc-tab-nav-bar{border:none}header[_ngcontent-%COMP%]   .profile-selector[_ngcontent-%COMP%]{flex:0 0 200px;margin-right:12px;margin-top:8px;height:38px}header[_ngcontent-%COMP%]   .profile-selector[_ngcontent-%COMP%]   mat-select-trigger[_ngcontent-%COMP%]   app-avatar[_ngcontent-%COMP%]{height:15px;vertical-align:middle;font-size:0}header[_ngcontent-%COMP%]   .profile-selector[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{padding:7px 0;min-height:38px}header[_ngcontent-%COMP%]   .settings-icon[_ngcontent-%COMP%]{flex:0 0 auto;margin:12px;cursor:pointer}app-notification-tray-view[_ngcontent-%COMP%]{position:fixed;bottom:10px;left:10px;margin-right:10px;margin-top:10px;z-index:1000}.dark-theme[_nghost-%COMP%]   header[_ngcontent-%COMP%], .dark-theme   [_nghost-%COMP%]   header[_ngcontent-%COMP%]{border-bottom-color:#ffffff1f}.dark-theme[_nghost-%COMP%]   header[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .dark-theme   [_nghost-%COMP%]   header[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#90a4ae}.light-theme[_nghost-%COMP%]   header[_ngcontent-%COMP%], .light-theme   [_nghost-%COMP%]   header[_ngcontent-%COMP%]{border-bottom-color:#0000001f}.light-theme[_nghost-%COMP%]   header[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .light-theme   [_nghost-%COMP%]   header[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#90a4ae}"],changeDetection:0})}}return Te([Le(ke.profiles)],t.prototype,"profiles",void 0),Te([Le(ke.selectedProfileId)],t.prototype,"selectedProfileId",void 0),Te([Le(ke.selectedProfile)],t.prototype,"selectedProfile",void 0),Te([Le(E.selectedRepositoryPath)],t.prototype,"selectedRepositoryPath",void 0),t})();var Bn=[{path:"",component:qi,children:[{path:"blame",canActivate:[_e],loadChildren:()=>import("./chunk-ZDZELL4V.js").then(t=>t.BlameLayoutModule)},{path:"changelog",loadChildren:()=>import("./chunk-R76J3UUQ.js").then(t=>t.ChangelogLayoutModule)},{path:"default",canActivate:[_e],loadChildren:()=>import("./chunk-E4YFG277.js").then(t=>t.DefaultLayoutModule)},{path:"open-repository",loadChildren:()=>import("./chunk-CAFHHVV4.js").then(t=>t.OpenRepositoryLayoutModule)},{path:"pull-request/create/:type/:integrationId",canActivate:[_e,xt],component:Vi},{path:"pull-request/view/:type/:owner/:repo/:id",canActivate:[_e,xt],component:Ti},{path:"rebase",canActivate:[_e],loadChildren:()=>import("./chunk-U2BZORE5.js").then(t=>t.RebaseLayoutModule)},{path:"search",canActivate:[_e],loadChildren:()=>import("./chunk-DMLLT2O5.js").then(t=>t.SearchLayoutModule)},{path:"",redirectTo:"default",pathMatch:"full"}]}],Ai=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=be({type:t})}static{this.\u0275inj=Pe({imports:[bt.forChild(Bn),bt]})}}return t})();var cr=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=be({type:t})}static{this.\u0275inj=Pe({imports:[Xt,ct,st,oi,Fi,yi,Ai]})}}return t})();export{cr as StandardLayoutModule};
